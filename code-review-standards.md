# 智游助手v6.2 代码评审标准

## 📋 评审检查清单

### 🏗️ 架构层面检查

#### 1. 模块职责和依赖
- [ ] **单一职责原则**: 每个模块只负责一个明确的功能
- [ ] **依赖方向正确**: 高层模块不依赖低层模块，都依赖抽象
- [ ] **无循环依赖**: 模块间不存在循环依赖关系
- [ ] **接口隔离**: 接口设计遵循最小知识原则

#### 2. 设计模式应用
- [ ] **工厂模式**: 复杂对象创建使用工厂模式
- [ ] **单例模式**: 全局唯一资源使用单例模式（如配置管理）
- [ ] **策略模式**: 算法变化使用策略模式
- [ ] **观察者模式**: 事件通知使用观察者模式

#### 3. 错误处理策略
- [ ] **统一错误处理**: 使用统一的错误处理机制
- [ ] **降级策略**: 关键服务有降级处理
- [ ] **熔断机制**: 外部依赖有熔断保护
- [ ] **错误日志**: 错误信息结构化记录

### 💻 代码层面检查

#### 1. 命名规范
- [ ] **有意义的名称**: 变量、函数、类名能表达其用途
- [ ] **一致的命名风格**: 遵循项目命名约定
- [ ] **避免缩写**: 除非是广泛认知的缩写
- [ ] **布尔变量**: 使用is/has/can等前缀

#### 2. 函数设计
- [ ] **函数长度**: 单个函数不超过50行
- [ ] **参数数量**: 函数参数不超过5个
- [ ] **纯函数优先**: 尽量使用纯函数，避免副作用
- [ ] **返回值一致**: 函数返回值类型一致

#### 3. 代码复杂度
- [ ] **圈复杂度**: 单个函数圈复杂度不超过10
- [ ] **嵌套深度**: 代码嵌套不超过4层
- [ ] **重复代码**: 无重复代码，遵循DRY原则
- [ ] **魔法数字**: 无硬编码数字，使用常量

#### 4. TypeScript特定检查
- [ ] **类型安全**: 避免使用any类型
- [ ] **接口定义**: 复杂对象使用接口定义
- [ ] **泛型使用**: 适当使用泛型提高复用性
- [ ] **空值检查**: 正确处理null/undefined

### 🧪 测试层面检查

#### 1. 单元测试
- [ ] **测试覆盖率**: 核心业务逻辑覆盖率>80%
- [ ] **测试用例**: 包含正常、边界、异常情况
- [ ] **测试独立性**: 测试用例间相互独立
- [ ] **测试命名**: 测试用例名称清晰表达测试意图

#### 2. 集成测试
- [ ] **关键路径**: 重要业务流程有集成测试
- [ ] **外部依赖**: 外部服务调用有测试覆盖
- [ ] **数据库操作**: 数据库相关操作有测试
- [ ] **API端点**: 所有API端点有测试

#### 3. 测试质量
- [ ] **断言明确**: 测试断言清晰具体
- [ ] **Mock合理**: 合理使用Mock，不过度Mock
- [ ] **测试数据**: 使用有意义的测试数据
- [ ] **清理资源**: 测试后正确清理资源

### 📊 监控层面检查

#### 1. 指标埋点
- [ ] **关键指标**: 重要业务节点有指标埋点
- [ ] **指标命名**: 遵循Prometheus命名规范
- [ ] **标签使用**: 合理使用标签，避免高基数
- [ ] **性能影响**: 监控不影响业务性能

#### 2. 日志记录
- [ ] **结构化日志**: 使用结构化日志格式
- [ ] **日志级别**: 正确使用日志级别
- [ ] **敏感信息**: 不记录敏感信息
- [ ] **上下文信息**: 包含足够的上下文信息

#### 3. 错误监控
- [ ] **异常捕获**: 所有异常都被正确捕获
- [ ] **错误分类**: 错误按类型和严重程度分类
- [ ] **告警规则**: 关键错误有告警规则
- [ ] **恢复机制**: 有自动恢复或降级机制

### 🔒 安全层面检查

#### 1. 输入验证
- [ ] **参数校验**: 所有外部输入都经过验证
- [ ] **SQL注入**: 防止SQL注入攻击
- [ ] **XSS防护**: 防止跨站脚本攻击
- [ ] **CSRF防护**: 防止跨站请求伪造

#### 2. 数据保护
- [ ] **敏感数据**: 敏感数据加密存储
- [ ] **传输加密**: 敏感数据传输加密
- [ ] **访问控制**: 实现适当的访问控制
- [ ] **审计日志**: 重要操作有审计日志

### 📝 文档层面检查

#### 1. 代码注释
- [ ] **函数注释**: 复杂函数有清晰注释
- [ ] **业务逻辑**: 复杂业务逻辑有说明
- [ ] **TODO标记**: 临时代码有TODO标记
- [ ] **注释更新**: 注释与代码保持同步

#### 2. API文档
- [ ] **接口文档**: 所有API有完整文档
- [ ] **参数说明**: 参数类型和含义清晰
- [ ] **示例代码**: 提供使用示例
- [ ] **错误码**: 错误响应有说明

## 🔧 评审工具和流程

### 自动化检查工具
```bash
# 代码质量检查
npm run lint              # ESLint检查
npm run type-check        # TypeScript类型检查
npm run test:coverage     # 测试覆盖率检查
npm run complexity        # 代码复杂度检查

# 安全检查
npm audit                 # 依赖安全检查
npm run security-scan     # 代码安全扫描
```

### 评审流程
1. **自检阶段**: 开发者使用检查清单自检
2. **工具检查**: 运行自动化检查工具
3. **同行评审**: 至少2名同事评审
4. **架构评审**: 重要变更需架构师评审
5. **测试验证**: 确保所有测试通过
6. **文档更新**: 更新相关文档

### 评审标准
- **必须修复**: 安全问题、功能缺陷、架构违规
- **建议修复**: 代码风格、性能优化、可读性
- **可选修复**: 重构建议、最佳实践

## 📊 质量度量指标

### 代码质量指标
- **圈复杂度**: 平均<5，最大<10
- **代码重复率**: <5%
- **测试覆盖率**: >80%
- **技术债务**: 每月减少10%

### 评审效率指标
- **评审时间**: 平均<2小时
- **修复时间**: 平均<4小时
- **返工率**: <10%
- **缺陷逃逸率**: <5%

### 团队协作指标
- **评审参与率**: >90%
- **知识分享**: 每周>1次
- **文档完整性**: >90%
- **团队满意度**: >85%

## 🎯 持续改进机制

### 定期回顾
- **周回顾**: 评审问题和改进建议
- **月总结**: 质量指标趋势分析
- **季度优化**: 流程和标准优化

### 知识分享
- **技术分享**: 每周技术分享会
- **最佳实践**: 维护最佳实践库
- **案例分析**: 定期分析典型案例

### 工具改进
- **自动化提升**: 持续改进自动化工具
- **模板更新**: 定期更新代码模板
- **规范完善**: 根据实践完善规范

## 📚 参考资源

### 编码规范
- [TypeScript Style Guide](https://typescript-eslint.io/rules/)
- [React Best Practices](https://react.dev/learn)
- [Node.js Best Practices](https://github.com/goldbergyoni/nodebestpractices)

### 架构设计
- [Clean Architecture](https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html)
- [SOLID Principles](https://en.wikipedia.org/wiki/SOLID)
- [Design Patterns](https://refactoring.guru/design-patterns)

### 测试指南
- [Jest Testing Framework](https://jestjs.io/docs/getting-started)
- [Testing Best Practices](https://github.com/goldbergyoni/javascript-testing-best-practices)
- [Test-Driven Development](https://martinfowler.com/bliki/TestDrivenDevelopment.html)

---

**注意**: 此标准将根据项目实践持续更新和完善。所有团队成员都应该熟悉并遵循这些标准。
