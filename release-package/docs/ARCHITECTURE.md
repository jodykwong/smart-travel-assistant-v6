# æ™ºæ¸¸åŠ©æ‰‹v6.5 - ç³»ç»Ÿæ¶æ„æ–‡æ¡£

## ğŸ“‹ ç›®å½•

- [1. æ¶æ„æ¦‚è¿°](#1-æ¶æ„æ¦‚è¿°)
- [2. ç³»ç»Ÿæ¶æ„](#2-ç³»ç»Ÿæ¶æ„)
- [3. æŠ€æœ¯æ ˆ](#3-æŠ€æœ¯æ ˆ)
- [4. æ ¸å¿ƒæ¨¡å—](#4-æ ¸å¿ƒæ¨¡å—)
- [5. æ•°æ®æµ](#5-æ•°æ®æµ)
- [6. ç¼“å­˜æ¶æ„](#6-ç¼“å­˜æ¶æ„)
- [7. å®‰å…¨æ¶æ„](#7-å®‰å…¨æ¶æ„)
- [8. éƒ¨ç½²æ¶æ„](#8-éƒ¨ç½²æ¶æ„)

---

## 1. æ¶æ„æ¦‚è¿°

### 1.1 è®¾è®¡åŸåˆ™

æ™ºæ¸¸åŠ©æ‰‹v6.5åŸºäºä»¥ä¸‹æ ¸å¿ƒè®¾è®¡åŸåˆ™æ„å»ºï¼š

#### **ç¬¬ä¸€æ€§åŸç†**
- å›å½’æ—…æ¸¸è§„åˆ’çš„æœ¬è´¨éœ€æ±‚ï¼šä¸ªæ€§åŒ–ã€å‡†ç¡®æ€§ã€å®ç”¨æ€§
- ä»ç”¨æˆ·ä»·å€¼å‡ºå‘ï¼Œæ„å»ºæœ€ç®€æ´æœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆ

#### **é«˜å†…èšï¼Œä½è€¦åˆ**
- æ¯ä¸ªæ¨¡å—ä¸“æ³¨å•ä¸€èŒè´£
- æ¨¡å—é—´é€šè¿‡æ ‡å‡†åŒ–APIé€šä¿¡
- æ”¯æŒç‹¬ç«‹å¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²

#### **ä¸ºå¤±è´¥è€Œè®¾è®¡**
- å¤šå±‚é™çº§æœºåˆ¶
- ç¼“å­˜å®¹é”™ç­–ç•¥
- ä¼˜é›…çš„é”™è¯¯å¤„ç†

#### **APIä¼˜å…ˆè®¾è®¡**
- å‰åç«¯åˆ†ç¦»
- æ ‡å‡†åŒ–RESTful API
- æ”¯æŒå¤šå®¢æˆ·ç«¯æ¥å…¥

### 1.2 æ¶æ„ç‰¹ç‚¹

- **å¾®æœåŠ¡åŒ–**: æ¨¡å—åŒ–è®¾è®¡ï¼Œæ”¯æŒç‹¬ç«‹æ‰©å±•
- **äº‹ä»¶é©±åŠ¨**: å¼‚æ­¥å¤„ç†ï¼Œæå‡å“åº”æ€§èƒ½
- **å¤šå±‚ç¼“å­˜**: Redis + å†…å­˜ç¼“å­˜ï¼Œä¼˜åŒ–æ€§èƒ½
- **å®æ—¶é€šä¿¡**: WebSocketæ”¯æŒå®æ—¶çŠ¶æ€æ›´æ–°
- **å®¹å™¨åŒ–**: Dockeræ”¯æŒï¼Œä¾¿äºéƒ¨ç½²å’Œæ‰©å±•

---

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·å±‚ (User Layer)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Web Browser  â”‚  Mobile App  â”‚  API Clients  â”‚  Admin Panel â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ¥å…¥å±‚ (Access Layer)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           CDN          â”‚        Load Balancer               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      åº”ç”¨å±‚ (Application Layer)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Next.js Frontend  â”‚  API Gateway  â”‚  WebSocket Server      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æœåŠ¡å±‚ (Service Layer)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Planning Service â”‚ Cache Service â”‚ Auth Service â”‚ Data Serviceâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ•°æ®å±‚ (Data Layer)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   SQLite DB    â”‚   Redis Cache   â”‚   File Storage           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å¤–éƒ¨æœåŠ¡å±‚ (External Layer)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  DeepSeek API  â”‚  é«˜å¾·MCP API  â”‚  Weather API  â”‚  Other APIs â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ ¸å¿ƒç»„ä»¶

#### **å‰ç«¯åº”ç”¨ (Next.js)**
- **èŒè´£**: ç”¨æˆ·ç•Œé¢ã€äº¤äº’é€»è¾‘ã€çŠ¶æ€ç®¡ç†
- **æŠ€æœ¯**: React 18 + Next.js 15 + TypeScript
- **ç‰¹æ€§**: æœåŠ¡ç«¯æ¸²æŸ“ã€ä»£ç åˆ†å‰²ã€å“åº”å¼è®¾è®¡

#### **APIç½‘å…³**
- **èŒè´£**: è¯·æ±‚è·¯ç”±ã€è®¤è¯æˆæƒã€é™æµæ§åˆ¶
- **æŠ€æœ¯**: Next.js API Routes
- **ç‰¹æ€§**: ç»Ÿä¸€å…¥å£ã€å®‰å…¨æ§åˆ¶ã€ç›‘æ§æ—¥å¿—

#### **è§„åˆ’æœåŠ¡ (Planning Service)**
- **èŒè´£**: æ—…æ¸¸è§„åˆ’æ ¸å¿ƒé€»è¾‘ã€LangGraphç¼–æ’
- **æŠ€æœ¯**: Python + LangGraph + DeepSeek API
- **ç‰¹æ€§**: æ™ºèƒ½è§„åˆ’ã€çŠ¶æ€ç®¡ç†ã€è¿›åº¦è¿½è¸ª

#### **ç¼“å­˜æœåŠ¡ (Cache Service)**
- **èŒè´£**: å¤šå±‚ç¼“å­˜ç®¡ç†ã€æ€§èƒ½ä¼˜åŒ–
- **æŠ€æœ¯**: Redis + å†…å­˜ç¼“å­˜
- **ç‰¹æ€§**: æ™ºèƒ½ç¼“å­˜ã€è‡ªåŠ¨å¤±æ•ˆã€ç»Ÿè®¡ç›‘æ§

---

## 3. æŠ€æœ¯æ ˆ

### 3.1 å‰ç«¯æŠ€æœ¯æ ˆ

```typescript
// æ ¸å¿ƒæ¡†æ¶
React: 18.x          // UIæ¡†æ¶
Next.js: 15.x        // å…¨æ ˆæ¡†æ¶
TypeScript: 5.x      // ç±»å‹ç³»ç»Ÿ

// æ ·å¼å’ŒUI
Tailwind CSS: 3.x    // åŸå­åŒ–CSS
Framer Motion: 11.x  // åŠ¨ç”»åº“
Lucide React: 0.x    // å›¾æ ‡åº“

// çŠ¶æ€ç®¡ç†
React Query: 5.x     // æœåŠ¡ç«¯çŠ¶æ€
Zustand: 4.x         // å®¢æˆ·ç«¯çŠ¶æ€

// å·¥å…·åº“
Axios: 1.x           // HTTPå®¢æˆ·ç«¯
Date-fns: 3.x        // æ—¥æœŸå¤„ç†
Zod: 3.x             // æ•°æ®éªŒè¯
```

### 3.2 åç«¯æŠ€æœ¯æ ˆ

```python
# æ ¸å¿ƒæ¡†æ¶
Next.js API Routes   # APIæœåŠ¡
Python: 3.8+         # è§„åˆ’æœåŠ¡
LangGraph: 0.x       # AIç¼–æ’

# æ•°æ®åº“å’Œç¼“å­˜
SQLite: 3.x          # ä¸»æ•°æ®åº“
Redis: 7.x           # ç¼“å­˜æ•°æ®åº“
ioredis: 5.x         # Rediså®¢æˆ·ç«¯

# AIå’Œå¤–éƒ¨æœåŠ¡
DeepSeek API         # å¤§è¯­è¨€æ¨¡å‹
é«˜å¾·MCP API          # åœ°å›¾æœåŠ¡
OpenAI: 1.x          # AIå·¥å…·åº“
```

### 3.3 å¼€å‘å’Œéƒ¨ç½²

```yaml
# å¼€å‘å·¥å…·
ESLint: 8.x          # ä»£ç æ£€æŸ¥
Prettier: 3.x        # ä»£ç æ ¼å¼åŒ–
Husky: 9.x           # Gité’©å­
Lint-staged: 15.x    # æš‚å­˜åŒºæ£€æŸ¥

# æµ‹è¯•å·¥å…·
Playwright: 1.x      # ç«¯åˆ°ç«¯æµ‹è¯•
Vitest: 1.x          # å•å…ƒæµ‹è¯•
Testing Library: 14.x # ç»„ä»¶æµ‹è¯•

# éƒ¨ç½²å·¥å…·
Docker: 24.x         # å®¹å™¨åŒ–
Docker Compose: 2.x  # å®¹å™¨ç¼–æ’
PM2: 5.x             # è¿›ç¨‹ç®¡ç†
```

---

## 4. æ ¸å¿ƒæ¨¡å—

### 4.1 è§„åˆ’å¼•æ“ (Planning Engine)

```typescript
interface PlanningEngine {
  // æ ¸å¿ƒè§„åˆ’æ–¹æ³•
  generatePlan(request: PlanningRequest): Promise<PlanningResult>;
  
  // çŠ¶æ€ç®¡ç†
  getSessionStatus(sessionId: string): Promise<SessionStatus>;
  updateProgress(sessionId: string, progress: number): Promise<void>;
  
  // å¤æ‚åº¦åˆ†æ
  analyzeComplexity(destination: string, days: number): Promise<ComplexityResult>;
}
```

**èŒè´£**:
- æ—…æ¸¸è§„åˆ’æ ¸å¿ƒé€»è¾‘
- LangGraphçŠ¶æ€å›¾ç¼–æ’
- è¿›åº¦è·Ÿè¸ªå’ŒçŠ¶æ€ç®¡ç†
- å¤æ‚åº¦åˆ†æå’Œä¼˜åŒ–

**å…³é”®ç‰¹æ€§**:
- æ”¯æŒ13å¤©æ–°ç–†æ·±åº¦æ¸¸ç­‰å¤æ‚è§„åˆ’
- å®æ—¶è¿›åº¦æ›´æ–°
- æ™ºèƒ½é™çº§æœºåˆ¶
- å¤šè½®ä¼˜åŒ–ç®—æ³•

### 4.2 ç¼“å­˜ç®¡ç† (Cache Manager)

```typescript
interface CacheManager {
  // åŸºç¡€ç¼“å­˜æ“ä½œ
  get<T>(key: string): Promise<T | null>;
  set<T>(key: string, data: T, ttl?: number): Promise<void>;
  delete(key: string): Promise<void>;
  
  // æ™ºèƒ½ç¼“å­˜
  cacheApiResponse<T>(
    apiName: string,
    params: any,
    fetcher: () => Promise<T>,
    ttl?: number
  ): Promise<T>;
  
  // ç»Ÿè®¡å’Œç›‘æ§
  getStats(): CacheStats;
  clearByPattern(pattern: string): Promise<void>;
}
```

**ç¼“å­˜ç­–ç•¥**:
- **DeepSeek API**: 24å°æ—¶TTLï¼Œè¯­ä¹‰åŒ–ç¼“å­˜é”®
- **é«˜å¾·MCP API**: 1-7å¤©TTLï¼Œåœ°ç†æ•°æ®ç¼“å­˜
- **ç”¨æˆ·ä¼šè¯**: 7å¤©TTLï¼Œä¼šè¯çŠ¶æ€ç¼“å­˜
- **é™æ€èµ„æº**: 30å¤©TTLï¼ŒCDNç¼“å­˜

### 4.3 ä¼šè¯ç®¡ç† (Session Manager)

```typescript
interface SessionManager {
  // ä¼šè¯ç”Ÿå‘½å‘¨æœŸ
  createSession(preferences: UserPreferences): Promise<Session>;
  getSession(sessionId: string): Promise<Session | null>;
  updateSession(sessionId: string, updates: Partial<Session>): Promise<void>;
  deleteSession(sessionId: string): Promise<void>;
  
  // çŠ¶æ€ç®¡ç†
  updateStatus(sessionId: string, status: SessionStatus): Promise<void>;
  updateProgress(sessionId: string, progress: number): Promise<void>;
}
```

**æ•°æ®æ¨¡å‹**:
```typescript
interface Session {
  id: string;
  userId?: string;
  destination: string;
  preferences: UserPreferences;
  status: 'pending' | 'processing' | 'completed' | 'failed';
  progress: number;
  result?: PlanningResult;
  createdAt: Date;
  updatedAt: Date;
}
```

---

## 5. æ•°æ®æµ

### 5.1 è§„åˆ’è¯·æ±‚æµç¨‹

```mermaid
sequenceDiagram
    participant U as User
    participant F as Frontend
    participant A as API Gateway
    participant P as Planning Service
    participant C as Cache Service
    participant D as DeepSeek API
    participant M as é«˜å¾·MCP API

    U->>F: æäº¤è§„åˆ’è¯·æ±‚
    F->>A: POST /api/v1/planning/sessions
    A->>P: åˆ›å»ºè§„åˆ’ä¼šè¯
    P->>A: è¿”å›ä¼šè¯ID
    A->>F: è¿”å›ä¼šè¯ä¿¡æ¯
    F->>A: POST /api/v1/planning/sessions/{id}/start
    A->>P: å¯åŠ¨è§„åˆ’æµç¨‹
    
    loop è§„åˆ’è¿‡ç¨‹
        P->>C: æ£€æŸ¥ç¼“å­˜
        alt ç¼“å­˜å‘½ä¸­
            C->>P: è¿”å›ç¼“å­˜æ•°æ®
        else ç¼“å­˜æœªå‘½ä¸­
            P->>D: è°ƒç”¨DeepSeek API
            D->>P: è¿”å›AIè§„åˆ’ç»“æœ
            P->>C: å­˜å‚¨åˆ°ç¼“å­˜
        end
        
        P->>M: è·å–åœ°ç†æ•°æ®
        M->>P: è¿”å›POIä¿¡æ¯
        P->>A: æ›´æ–°è¿›åº¦çŠ¶æ€
        A->>F: WebSocketæ¨é€è¿›åº¦
        F->>U: æ˜¾ç¤ºè¿›åº¦æ›´æ–°
    end
    
    P->>A: è§„åˆ’å®Œæˆ
    A->>F: è¿”å›æœ€ç»ˆç»“æœ
    F->>U: å±•ç¤ºè§„åˆ’ç»“æœ
```

### 5.2 ç¼“å­˜æ•°æ®æµ

```mermaid
graph TD
    A[APIè¯·æ±‚] --> B{æ£€æŸ¥å†…å­˜ç¼“å­˜}
    B -->|å‘½ä¸­| C[è¿”å›ç¼“å­˜æ•°æ®]
    B -->|æœªå‘½ä¸­| D{æ£€æŸ¥Redisç¼“å­˜}
    D -->|å‘½ä¸­| E[åŒæ­¥åˆ°å†…å­˜ç¼“å­˜]
    E --> C
    D -->|æœªå‘½ä¸­| F[è°ƒç”¨å¤–éƒ¨API]
    F --> G[å­˜å‚¨åˆ°Redis]
    G --> H[å­˜å‚¨åˆ°å†…å­˜ç¼“å­˜]
    H --> C
```

---

## 6. ç¼“å­˜æ¶æ„

### 6.1 å¤šå±‚ç¼“å­˜è®¾è®¡

```typescript
// L1: å†…å­˜ç¼“å­˜ (æœ€å¿«)
class MemoryCache {
  private cache = new Map<string, CacheItem>();
  private maxItems = 1000;
  private defaultTTL = 3600; // 1å°æ—¶
}

// L2: Redisç¼“å­˜ (æŒä¹…åŒ–)
class RedisCache {
  private redis: Redis;
  private defaultTTL = 86400; // 24å°æ—¶
}

// ç»Ÿä¸€ç¼“å­˜æ¥å£
class CacheService {
  async get<T>(key: string): Promise<T | null> {
    // 1. æ£€æŸ¥å†…å­˜ç¼“å­˜
    const memoryResult = await this.memoryCache.get(key);
    if (memoryResult) return memoryResult;
    
    // 2. æ£€æŸ¥Redisç¼“å­˜
    const redisResult = await this.redisCache.get(key);
    if (redisResult) {
      // åŒæ­¥åˆ°å†…å­˜ç¼“å­˜
      await this.memoryCache.set(key, redisResult);
      return redisResult;
    }
    
    return null;
  }
}
```

### 6.2 ç¼“å­˜ç­–ç•¥

| æ•°æ®ç±»å‹ | TTL | ç¼“å­˜å±‚çº§ | æ›´æ–°ç­–ç•¥ |
|----------|-----|----------|----------|
| DeepSeekè§„åˆ’ç»“æœ | 24å°æ—¶ | L1 + L2 | è¯­ä¹‰åŒ–é”®å€¼ |
| é«˜å¾·POIæ•°æ® | 2å°æ—¶ | L1 + L2 | åœ°ç†ä½ç½®é”®å€¼ |
| å¤©æ°”æ•°æ® | 30åˆ†é’Ÿ | L1 + L2 | åŸå¸‚+æ—¥æœŸé”®å€¼ |
| ç”¨æˆ·ä¼šè¯ | 7å¤© | L2 | ä¼šè¯IDé”®å€¼ |
| é™æ€é…ç½® | 1å¤© | L1 | é…ç½®é”®å€¼ |

### 6.3 ç¼“å­˜ç›‘æ§

```typescript
interface CacheMetrics {
  hitRate: number;           // å‘½ä¸­ç‡
  missRate: number;          // æœªå‘½ä¸­ç‡
  totalRequests: number;     // æ€»è¯·æ±‚æ•°
  cacheSize: number;         // ç¼“å­˜å¤§å°
  evictionCount: number;     // æ·˜æ±°æ¬¡æ•°
  averageResponseTime: number; // å¹³å‡å“åº”æ—¶é—´
}
```

---

## 7. å®‰å…¨æ¶æ„

### 7.1 è®¤è¯å’Œæˆæƒ

```typescript
// JWTè®¤è¯
interface AuthService {
  generateToken(user: User): Promise<string>;
  verifyToken(token: string): Promise<User | null>;
  refreshToken(refreshToken: string): Promise<string>;
}

// æƒé™æ§åˆ¶
interface AuthorizationService {
  checkPermission(user: User, resource: string, action: string): boolean;
  getRolePermissions(role: string): Permission[];
}
```

### 7.2 APIå®‰å…¨

- **HTTPSå¼ºåˆ¶**: æ‰€æœ‰APIé€šä¿¡ä½¿ç”¨HTTPS
- **CORSé…ç½®**: ä¸¥æ ¼çš„è·¨åŸŸèµ„æºå…±äº«ç­–ç•¥
- **é™æµæ§åˆ¶**: APIè°ƒç”¨é¢‘ç‡é™åˆ¶
- **è¾“å…¥éªŒè¯**: æ‰€æœ‰è¾“å…¥æ•°æ®éªŒè¯å’Œæ¸…ç†
- **SQLæ³¨å…¥é˜²æŠ¤**: å‚æ•°åŒ–æŸ¥è¯¢å’ŒORMä½¿ç”¨

### 7.3 æ•°æ®å®‰å…¨

- **æ•æ„Ÿæ•°æ®åŠ å¯†**: APIå¯†é’¥å’Œç”¨æˆ·æ•°æ®åŠ å¯†å­˜å‚¨
- **æ•°æ®è„±æ•**: æ—¥å¿—ä¸­æ•æ„Ÿä¿¡æ¯è„±æ•
- **å¤‡ä»½åŠ å¯†**: æ•°æ®åº“å¤‡ä»½åŠ å¯†å­˜å‚¨
- **è®¿é—®æ—¥å¿—**: å®Œæ•´çš„æ•°æ®è®¿é—®å®¡è®¡æ—¥å¿—

---

## 8. éƒ¨ç½²æ¶æ„

### 8.1 å®¹å™¨åŒ–éƒ¨ç½²

```yaml
# docker-compose.yml
version: '3.8'
services:
  app:
    build: .
    ports:
      - "3001:3001"
    environment:
      - NODE_ENV=production
    depends_on:
      - redis
      - db
    
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    
  db:
    image: sqlite:latest
    volumes:
      - db_data:/data
```

### 8.2 Kuberneteséƒ¨ç½²

```yaml
# k8s/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: smart-travel-assistant
spec:
  replicas: 3
  selector:
    matchLabels:
      app: smart-travel-assistant
  template:
    spec:
      containers:
      - name: app
        image: smart-travel-assistant:v6.0
        ports:
        - containerPort: 3001
        resources:
          requests:
            memory: "256Mi"
            cpu: "250m"
          limits:
            memory: "512Mi"
            cpu: "500m"
```

### 8.3 ç›‘æ§å’Œæ—¥å¿—

```typescript
// ç›‘æ§æŒ‡æ ‡
interface SystemMetrics {
  // åº”ç”¨æŒ‡æ ‡
  requestsPerSecond: number;
  averageResponseTime: number;
  errorRate: number;
  
  // ç¼“å­˜æŒ‡æ ‡
  cacheHitRate: number;
  cacheSize: number;
  
  // ç³»ç»ŸæŒ‡æ ‡
  cpuUsage: number;
  memoryUsage: number;
  diskUsage: number;
}
```

---

## æ€»ç»“

æ™ºæ¸¸åŠ©æ‰‹v6.5é‡‡ç”¨ç°ä»£åŒ–çš„å¾®æœåŠ¡æ¶æ„ï¼Œé€šè¿‡å¤šå±‚ç¼“å­˜ã€æ™ºèƒ½è§„åˆ’å’Œå®æ—¶é€šä¿¡ç­‰æŠ€æœ¯ï¼Œå®ç°äº†é«˜æ€§èƒ½ã€é«˜å¯ç”¨çš„ä¼ä¸šçº§æ—…æ¸¸è§„åˆ’ç³»ç»Ÿã€‚ç³»ç»Ÿè®¾è®¡éµå¾ªSOLIDåŸåˆ™å’Œæœ€ä½³å®è·µï¼Œå…·å¤‡è‰¯å¥½çš„å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

**å…³é”®ä¼˜åŠ¿**:
- **é«˜æ€§èƒ½**: å¤šå±‚ç¼“å­˜æ¶æ„ï¼ŒAPIå“åº”æ—¶é—´æå‡50%+
- **é«˜å¯ç”¨**: å¤šå±‚é™çº§æœºåˆ¶ï¼ŒæœåŠ¡å¯ç”¨æ€§99.9%+
- **å¯æ‰©å±•**: å¾®æœåŠ¡æ¶æ„ï¼Œæ”¯æŒæ°´å¹³æ‰©å±•
- **æ˜“ç»´æŠ¤**: æ¨¡å—åŒ–è®¾è®¡ï¼Œä»£ç è´¨é‡é«˜

**æŠ€æœ¯äº®ç‚¹**:
- DeepSeek + LangGraphæ™ºèƒ½è§„åˆ’
- Redis + å†…å­˜åŒå±‚ç¼“å­˜
- å®æ—¶WebSocketé€šä¿¡
- å®Œæ•´çš„ç›‘æ§å’Œæ—¥å¿—ä½“ç³»
