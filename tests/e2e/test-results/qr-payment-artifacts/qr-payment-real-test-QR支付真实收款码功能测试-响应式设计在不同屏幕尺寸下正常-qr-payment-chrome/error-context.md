# Page snapshot

```yaml
- alert
- dialog:
  - heading "Build Error" [level=1]
  - paragraph: Failed to compile
  - text: Next.js (14.2.31) is outdated
  - link "(learn more)":
    - /url: https://nextjs.org/docs/messages/version-staleness
  - link "./src/pages/payment.tsx":
    - text: ./src/pages/payment.tsx
    - img
  - text: "Error: × the name `handleQueryPayment` is defined multiple times ╭─[/Users/jodykwong/Documents/augment-projects/smart-travel-assistant-augment-v6.2/src/pages/payment.tsx:109:1] 109 │ }; 110 │ 111 │ // 查询支付状态 112 │ const handleQueryPayment = async (outTradeNo: string) => { · ─────────┬──────── · ╰── previous definition of `handleQueryPayment` here 113 │ try { 114 │ const response = await fetch(`/api/payment/query?outTradeNo=${outTradeNo}`, { 115 │ credentials: 'include' 116 │ }); 117 │ 118 │ const data = await response.json(); 119 │ 120 │ if (data.success) { 121 │ alert(`支付状态: ${data.status}`); 122 │ } else { 123 │ alert(`查询失败: ${data.error}`); 124 │ } 125 │ } catch (err) { 126 │ alert('查询失败，请稍后重试'); 127 │ } 128 │ }; 129 │ 130 │ return ( 131 │ <> 132 │ <Head> 133 │ <title>支付中心 - 智游助手v6.2</title> 134 │ <meta name=\"description\" content=\"智游助手支付中心，支持微信支付和支付宝\" /> 135 │ </Head> 136 │ 137 │ <div className=\"min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8\"> 138 │ <div className=\"max-w-3xl mx-auto\"> 139 │ <div className=\"text-center mb-8\"> 140 │ <h1 className=\"text-3xl font-extrabold text-gray-900\">支付中心</h1> 141 │ <p className=\"mt-2 text-gray-600\">选择服务并完成支付</p> 142 │ </div> 143 │ 144 │ <div className=\"bg-white shadow rounded-lg p-6\"> 145 │ {/* 服务选择 */} 146 │ <div className=\"mb-6\"> 147 │ <h2 className=\"text-lg font-medium text-gray-900 mb-4\">选择服务</h2> 148 │ <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\" data-testid=\"service-selector\"> 149 │ {serviceOptions.map(service => ( 150 │ <div 151 │ key={service.value} 152 │ className={`border rounded-lg p-4 cursor-pointer transition-colors ${ 153 │ formData.serviceType === service.value 154 │ ? 'border-indigo-500 bg-indigo-50' 155 │ : 'border-gray-300 hover:border-gray-400' 156 │ }`} 157 │ onClick={() => handleServiceChange(service.value)} 158 │ > 159 │ <h3 className=\"font-medium text-gray-900\">{service.label}</h3> 160 │ <p className=\"text-2xl font-bold text-indigo-600 mt-2\">¥{service.price}</p> 161 │ </div> 162 │ ))} 163 │ </div> 164 │ </div> 165 │ 166 │ {/* 订单信息 */} 167 │ <div className=\"mb-6 p-4 bg-gray-50 rounded-lg\"> 168 │ <h3 className=\"font-medium text-gray-900 mb-2\">订单信息</h3> 169 │ <div className=\"space-y-2 text-sm\"> 170 │ <div className=\"flex justify-between\"> 171 │ <span>服务名称:</span> 172 │ <span data-testid=\"order-description\">{formData.description}</span> 173 │ </div> 174 │ <div className=\"flex justify-between\"> 175 │ <span>订单金额:</span> 176 │ <span className=\"font-medium text-indigo-600\" data-testid=\"order-amount\"> 177 │ ¥{(formData.amount / 100).toFixed(2)} 178 │ </span> 179 │ </div> 180 │ </div> 181 │ </div> 182 │ 183 │ {/* 支付方式选择 */} 184 │ <div className=\"mb-6\"> 185 │ <h2 className=\"text-lg font-medium text-gray-900 mb-4\">选择支付方式</h2> 186 │ <div className=\"grid grid-cols-2 gap-4\"> 187 │ <label className=\"flex items-center p-4 border rounded-lg cursor-pointer hover:bg-gray-50\"> 188 │ <input 189 │ type=\"radio\" 190 │ name=\"paymentMethod\" 191 │ value=\"wechat\" 192 │ checked={formData.paymentMethod === 'wechat'} 193 │ onChange={() => handlePaymentMethodChange('wechat')} 194 │ className=\"mr-3\" 195 │ data-testid=\"payment-method-wechat\" 196 │ /> 197 │ <div> 198 │ <div className=\"font-medium text-gray-900\">微信支付</div> 199 │ <div className=\"text-sm text-gray-500\">安全便捷的移动支付</div> 200 │ </div> 201 │ </label> 202 │ 203 │ <label className=\"flex items-center p-4 border rounded-lg cursor-pointer hover:bg-gray-50\"> 204 │ <input 205 │ type=\"radio\" 206 │ name=\"paymentMethod\" 207 │ value=\"alipay\" 208 │ checked={formData.paymentMethod === 'alipay'} 209 │ onChange={() => handlePaymentMethodChange('alipay')} 210 │ className=\"mr-3\" 211 │ data-testid=\"payment-method-alipay\" 212 │ /> 213 │ <div> 214 │ <div className=\"font-medium text-gray-900\">支付宝</div> 215 │ <div className=\"text-sm text-gray-500\">支付宝安全支付</div> 216 │ </div> 217 │ </label> 218 │ </div> 219 │ </div> 220 │ 221 │ {/* 支付类型选择 */} 222 │ <div className=\"mb-6\"> 223 │ <h2 className=\"text-lg font-medium text-gray-900 mb-4\">支付类型</h2> 224 │ <div className=\"flex space-x-4\"> 225 │ <label className=\"flex items-center\"> 226 │ <input 227 │ type=\"radio\" 228 │ name=\"paymentType\" 229 │ value=\"h5\" 230 │ checked={formData.paymentType === 'h5'} 231 │ onChange={() => handlePaymentTypeChange('h5')} 232 │ className=\"mr-2\" 233 │ data-testid=\"payment-type-h5\" 234 │ /> 235 │ <span>手机支付</span> 236 │ </label> 237 │ <label className=\"flex items-center\"> 238 │ <input 239 │ type=\"radio\" 240 │ name=\"paymentType\" 241 │ value=\"qr\" 242 │ checked={formData.paymentType === 'qr'} 243 │ onChange={() => handlePaymentTypeChange('qr')} 244 │ className=\"mr-2\" 245 │ data-testid=\"payment-type-qr\" 246 │ /> 247 │ <span>扫码支付</span> 248 │ </label> 249 │ </div> 250 │ </div> 251 │ 252 │ {/* 错误提示 */} 253 │ {error && ( 254 │ <div className=\"mb-6 rounded-md bg-red-50 p-4\" data-testid=\"payment-error\"> 255 │ <div className=\"text-sm text-red-700\">{error}</div> 256 │ </div> 257 │ )} 258 │ 259 │ {/* 支付按钮 */} 260 │ <div className=\"mb-6\"> 261 │ <button 262 │ onClick={handleCreatePayment} 263 │ disabled={isLoading} 264 │ className=\"w-full bg-indigo-600 hover:bg-indigo-700 text-white py-3 px-4 rounded-md text-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed\" 265 │ data-testid=\"create-payment-button\" 266 │ > 267 │ {isLoading ? ( 268 │ <div className=\"flex items-center justify-center\"> 269 │ <div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2\"></div> 270 │ 创建支付订单... 271 │ </div> 272 │ ) : ( 273 │ `立即支付 ¥${(formData.amount / 100).toFixed(2)}` 274 │ )} 275 │ </button> 276 │ </div> 277 │ 278 │ {/* 支付结果 */} 279 │ {paymentResult && paymentResult.success && ( 280 │ <div className=\"bg-green-50 border border-green-200 rounded-lg p-6\" data-testid=\"payment-result\"> 281 │ <h3 className=\"text-lg font-medium text-green-900 mb-4\">支付订单创建成功</h3> 282 │ 283 │ <div className=\"space-y-2 text-sm\"> 284 │ <div className=\"flex justify-between\"> 285 │ <span>支付ID:</span> 286 │ <span className=\"font-mono\">{paymentResult.paymentId}</span> 287 │ </div> 288 │ <div className=\"flex justify-between\"> 289 │ <span>订单号:</span> 290 │ <span className=\"font-mono\">{paymentResult.outTradeNo}</span> 291 │ </div> 292 │ </div> 293 │ 294 │ {/* 二维码支付 */} 295 │ {paymentResult.qrCode && ( 296 │ <div className=\"mt-4 text-center\" data-testid=\"payment-qr-code\"> 297 │ <p className=\"text-sm text-gray-600 mb-2\">请使用{formData.paymentMethod === 'wechat' ? '微信' : '支付宝'}扫描二维码支付</p> 298 │ <img 299 │ src={paymentResult.qrCode} 300 │ alt=\"支付二维码\" 301 │ className=\"mx-auto w-48 h-48 border\" 302 │ /> 303 │ <p className=\"text-lg font-medium text-green-600 mt-2\" data-testid=\"qr-order-amount\"> 304 │ ¥{(formData.amount / 100).toFixed(2)} 305 │ </p> 306 │ </div> 307 │ )} 308 │ 309 │ {/* H5支付链接 */} 310 │ {paymentResult.paymentUrl && !paymentResult.qrCode && ( 311 │ <div className=\"mt-4 text-center\"> 312 │ <a 313 │ href={paymentResult.paymentUrl} 314 │ target=\"_blank\" 315 │ rel=\"noopener noreferrer\" 316 │ className=\"bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-md text-sm font-medium\" 317 │ > 318 │ 前往{formData.paymentMethod === 'wechat' ? '微信' : '支付宝'}支付 319 │ </a> 320 │ </div> 321 │ )} 322 │ 323 │ {/* 查询支付状态按钮 */} 324 │ <div className=\"mt-4 text-center\"> 325 │ <button 326 │ onClick={() => handleQueryPayment(paymentResult.outTradeNo!)} 327 │ className=\"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium\" 328 │ data-testid=\"query-payment-status\" 329 │ > 330 │ 查询支付状态 331 │ </button> 332 │ </div> 333 │ </div> 334 │ )} 335 │ </div> 336 │ 337 │ {/* 支付历史 */} 338 │ <div className=\"mt-8 bg-white shadow rounded-lg p-6\"> 339 │ <h2 className=\"text-lg font-medium text-gray-900 mb-4\">支付历史</h2> 340 │ <div className=\"space-y-4\"> 341 │ {/* 模拟支付历史记录 */} 342 │ <div className=\"border rounded-lg p-4\" data-testid=\"paid-order\"> 343 │ <div className=\"flex justify-between items-center\"> 344 │ <div> 345 │ <h3 className=\"font-medium text-gray-900\">智游助手旅游规划服务</h3> 346 │ <p className=\"text-sm text-gray-500\">订单号: ST202401081234567890</p> 347 │ <p className=\"text-sm text-green-600\">状态: 已支付</p> 348 │ </div> 349 │ <div className=\"text-right\"> 350 │ <p className=\"font-medium text-gray-900\">¥99.00</p> 351 │ <button 352 │ className=\"mt-2 bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-xs\" 353 │ data-testid=\"refund-button\" 354 │ onClick={() => handleRefundRequest('ST202401081234567890')} 355 │ > 356 │ 申请退款 357 │ </button> 358 │ </div> 359 │ </div> 360 │ </div> 361 │ </div> 362 │ </div> 363 │ </div> 364 │ </div> 365 │ 366 │ {/* 退款模态框 */} 367 │ {showRefundModal && ( 368 │ <div className=\"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center\"> 369 │ <div className=\"bg-white rounded-lg p-6 max-w-md w-full mx-4\" data-testid=\"refund-modal\"> 370 │ <h3 className=\"text-lg font-medium text-gray-900 mb-4\">申请退款</h3> 371 │ 372 │ <div className=\"space-y-4\"> 373 │ <div> 374 │ <label className=\"block text-sm font-medium text-gray-700\">退款金额</label> 375 │ <input 376 │ type=\"number\" 377 │ step=\"0.01\" 378 │ max=\"99.00\" 379 │ className=\"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md\" 380 │ data-testid=\"refund-amount\" 381 │ /> 382 │ </div> 383 │ 384 │ <div> 385 │ <label className=\"block text-sm font-medium text-gray-700\">退款原因</label> 386 │ <textarea 387 │ rows={3} 388 │ className=\"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md\" 389 │ placeholder=\"请输入退款原因\" 390 │ data-testid=\"refund-reason\" 391 │ /> 392 │ </div> 393 │ </div> 394 │ 395 │ <div className=\"mt-6 flex space-x-3\"> 396 │ <button 397 │ onClick={() => setShowRefundModal(false)} 398 │ className=\"flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 px-4 rounded-md\" 399 │ > 400 │ 取消 401 │ </button> 402 │ <button 403 │ onClick={handleSubmitRefund} 404 │ className=\"flex-1 bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-md\" 405 │ data-testid=\"submit-refund\" 406 │ > 407 │ 提交退款申请 408 │ </button> 409 │ </div> 410 │ </div> 411 │ </div> 412 │ )} 413 │ </> 414 │ ); 415 │ 416 │ // 退款相关状态和函数 417 │ const [showRefundModal, setShowRefundModal] = useState(false); 418 │ const [refundOrderNo, setRefundOrderNo] = useState<string>(''); 419 │ 420 │ function handleRefundRequest(outTradeNo: string) { 421 │ setRefundOrderNo(outTradeNo); 422 │ setShowRefundModal(true); 423 │ } 424 │ 425 │ async function handleSubmitRefund() { 426 │ // 实现退款提交逻辑 427 │ setShowRefundModal(false); 428 │ // 显示退款成功提示 429 │ alert('退款申请已提交'); 430 │ } 431 │ 432 │ async function handleQueryPayment(outTradeNo: string) { · ─────────┬──────── · ╰── `handleQueryPayment` redefined here 433 │ try { 434 │ const response = await fetch(`/api/payment/query?outTradeNo=${outTradeNo}`, { 435 │ credentials: 'include' ╰────"
  - contentinfo:
    - paragraph: This error occurred during the build process and can only be dismissed by fixing the error.
```