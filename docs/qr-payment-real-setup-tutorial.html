<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºæ¸¸åŠ©æ‰‹v6.2 - çœŸå®æ”¶æ¬¾ç é…ç½®æ•™ç¨‹</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .progress-bar {
            background: #ecf0f1;
            border-radius: 10px;
            height: 8px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            border-radius: 10px;
            width: 0%;
            transition: width 0.3s ease;
        }

        .nav-tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .nav-tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            color: #7f8c8d;
        }

        .nav-tab.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .card h2 {
            color: #2c3e50;
            font-size: 1.8em;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card h3 {
            color: #34495e;
            font-size: 1.3em;
            margin: 25px 0 15px 0;
            border-left: 4px solid #3498db;
            padding-left: 15px;
        }

        .step-list {
            list-style: none;
            counter-reset: step-counter;
        }

        .step-list li {
            counter-increment: step-counter;
            margin-bottom: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #3498db;
            position: relative;
        }

        .step-list li::before {
            content: "æ­¥éª¤ " counter(step-counter);
            position: absolute;
            top: -10px;
            left: 15px;
            background: #3498db;
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .code-block {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9em;
            margin: 15px 0;
            position: relative;
            overflow-x: auto;
        }

        .code-block::before {
            content: attr(data-lang);
            position: absolute;
            top: 10px;
            right: 15px;
            background: #34495e;
            color: #ecf0f1;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 0.7em;
            text-transform: uppercase;
        }

        .copy-btn {
            position: absolute;
            top: 10px;
            right: 80px;
            background: #27ae60;
            color: white;
            border: none;
            padding: 5px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8em;
            transition: background 0.3s ease;
        }

        .copy-btn:hover {
            background: #229954;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid;
            position: relative;
        }

        .alert-info {
            background: #e8f4fd;
            border-color: #3498db;
            color: #2980b9;
        }

        .alert-warning {
            background: #fef9e7;
            border-color: #f39c12;
            color: #d68910;
        }

        .alert-success {
            background: #eafaf1;
            border-color: #27ae60;
            color: #1e8449;
        }

        .alert-danger {
            background: #fdeaea;
            border-color: #e74c3c;
            color: #c0392b;
        }

        .btn {
            display: inline-block;
            padding: 12px 25px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            text-decoration: none;
            border-radius: 25px;
            font-weight: bold;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
        }

        .btn-warning {
            background: linear-gradient(45deg, #f39c12, #e67e22);
        }

        .btn-danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }

        .config-editor {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
        }

        .config-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9em;
            margin: 5px 0;
        }

        .config-label {
            font-weight: bold;
            color: #2c3e50;
            margin-top: 15px;
            margin-bottom: 5px;
            display: block;
        }

        .qr-preview {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }

        .qr-item {
            flex: 1;
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px dashed #ddd;
        }

        .qr-placeholder {
            width: 150px;
            height: 150px;
            background: #ecf0f1;
            border-radius: 10px;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .validation-result {
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            display: none;
        }

        .validation-result.show {
            display: block;
        }

        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .troubleshoot-item {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }

        .troubleshoot-item h4 {
            color: #d68910;
            margin-bottom: 10px;
        }

        @media (max-width: 768px) {
            .nav-tabs {
                flex-direction: column;
            }

            .two-column {
                grid-template-columns: 1fr;
            }

            .qr-preview {
                flex-direction: column;
            }
        }

        .highlight {
            background: linear-gradient(45deg, #fff3cd, #ffeaa7);
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: bold;
        }

        .command-hint {
            background: #e8f5e8;
            border: 1px solid #c3e6c3;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.85em;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨ -->
        <div class="header">
            <h1>ğŸš€ æ™ºæ¸¸åŠ©æ‰‹v6.2</h1>
            <div style="font-size: 1.2em; color: #7f8c8d; margin-bottom: 20px;">
                çœŸå®æ”¶æ¬¾ç é…ç½®æ•™ç¨‹
            </div>
            <div style="background: linear-gradient(45deg, #27ae60, #2ecc71); color: white; padding: 10px 20px; border-radius: 15px; display: inline-block;">
                <strong>âœ… ä»ç¤ºä¾‹æ•°æ®åˆ°çœŸå®æ”¶æ¬¾ | å®Œæ•´é…ç½®æŒ‡å—</strong>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressBar"></div>
            </div>
            <div id="progressText" style="margin-top: 10px; color: #7f8c8d;">å‡†å¤‡å¼€å§‹é…ç½®...</div>
        </div>

        <!-- å¯¼èˆªæ ‡ç­¾ -->
        <div class="nav-tabs">
            <div class="nav-tab active" onclick="showTab('step1')">
                <span style="font-size: 1.2em;">ğŸ“±</span><br>
                è·å–æ”¶æ¬¾ç 
            </div>
            <div class="nav-tab" onclick="showTab('step2')">
                <span style="font-size: 1.2em;">âš™ï¸</span><br>
                é…ç½®æ›¿æ¢
            </div>
            <div class="nav-tab" onclick="showTab('step3')">
                <span style="font-size: 1.2em;">ğŸ§ª</span><br>
                é›†æˆæµ‹è¯•
            </div>
            <div class="nav-tab" onclick="showTab('step4')">
                <span style="font-size: 1.2em;">ğŸ›¡ï¸</span><br>
                å®‰å…¨æ³¨æ„
            </div>
            <div class="nav-tab" onclick="showTab('step5')">
                <span style="font-size: 1.2em;">ğŸ”§</span><br>
                æ•…éšœæ’é™¤
            </div>
        </div>

        <!-- æ­¥éª¤1ï¼šè·å–çœŸå®æ”¶æ¬¾ç  -->
        <div id="step1" class="tab-content active">
            <div class="card">
                <h2><span style="font-size: 1.5em;">ğŸ“±</span>è·å–çœŸå®æ”¶æ¬¾ç </h2>

                <div class="alert alert-info">
                    <strong>ğŸ’¡ å½“å‰çŠ¶æ€</strong><br>
                    æ‚¨çš„é¡¹ç›®å·²é…ç½®ç¤ºä¾‹æ”¶æ¬¾ç æ•°æ®ï¼Œç°åœ¨éœ€è¦æ›¿æ¢ä¸ºçœŸå®çš„ä¸ªäººæ”¶æ¬¾ç ä»¥å®ç°çœŸå®æ”¶æ¬¾åŠŸèƒ½ã€‚
                </div>

                <div class="two-column">
                    <div>
                        <h3>ğŸŸ¢ å¾®ä¿¡ä¸ªäººæ”¶æ¬¾ç </h3>

                        <ol class="step-list">
                            <li>
                                <strong>æ‰“å¼€å¾®ä¿¡æ”¶æ¬¾ç </strong>
                                <p>æ‰“å¼€å¾®ä¿¡ â†’ å³ä¸Šè§’"+" â†’ æ”¶ä»˜æ¬¾ â†’ äºŒç»´ç æ”¶æ¬¾</p>
                                <div class="alert alert-warning">
                                    <strong>âš ï¸ æ³¨æ„</strong>ï¼šä½¿ç”¨ä¸ªäººæ”¶æ¬¾ç ï¼Œä¸æ˜¯å•†å®¶æ”¶æ¬¾ç 
                                </div>
                            </li>

                            <li>
                                <strong>ä¿å­˜æ”¶æ¬¾ç å›¾ç‰‡</strong>
                                <p>é•¿æŒ‰äºŒç»´ç  â†’ ä¿å­˜åˆ°ç›¸å†Œ</p>
                                <div class="command-hint">
                                    ğŸ’¡ å»ºè®®ä¿å­˜ä¸ºï¼šwechat_qr_code.png
                                </div>
                            </li>

                            <li>
                                <strong>æå–äºŒç»´ç æ•°æ®</strong>
                                <p>ä½¿ç”¨åœ¨çº¿äºŒç»´ç è§£æå·¥å…·æˆ–æ‰‹æœºæ‰«ç è·å–æ•°æ®ï¼š</p>
                                <div class="code-block" data-lang="example">
å¾®ä¿¡æ”¶æ¬¾ç æ ¼å¼ç¤ºä¾‹ï¼š
wxp://f2f0[é•¿ä¸²å­—ç¬¦]
æˆ–
weixin://wxpay/bizpayurl?pr=[å‚æ•°]
                                    <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                                </div>
                            </li>
                        </ol>
                    </div>

                    <div>
                        <h3>ğŸ”µ æ”¯ä»˜å®ä¸ªäººæ”¶æ¬¾ç </h3>

                        <ol class="step-list">
                            <li>
                                <strong>æ‰“å¼€æ”¯ä»˜å®æ”¶æ¬¾ç </strong>
                                <p>æ‰“å¼€æ”¯ä»˜å® â†’ é¦–é¡µ"æ”¶é’±" â†’ ä¸ªäººæ”¶æ¬¾</p>
                                <div class="alert alert-warning">
                                    <strong>âš ï¸ æ³¨æ„</strong>ï¼šé€‰æ‹©ä¸ªäººæ”¶æ¬¾ï¼Œä¸æ˜¯å•†å®¶æœåŠ¡
                                </div>
                            </li>

                            <li>
                                <strong>ä¿å­˜æ”¶æ¬¾ç å›¾ç‰‡</strong>
                                <p>ç‚¹å‡»"ä¿å­˜å›¾ç‰‡" æˆ– æˆªå›¾ä¿å­˜</p>
                                <div class="command-hint">
                                    ğŸ’¡ å»ºè®®ä¿å­˜ä¸ºï¼šalipay_qr_code.png
                                </div>
                            </li>

                            <li>
                                <strong>æå–äºŒç»´ç æ•°æ®</strong>
                                <p>ä½¿ç”¨åœ¨çº¿äºŒç»´ç è§£æå·¥å…·è·å–æ•°æ®ï¼š</p>
                                <div class="code-block" data-lang="example">
æ”¯ä»˜å®æ”¶æ¬¾ç æ ¼å¼ç¤ºä¾‹ï¼š
https://qr.alipay.com/[å‚æ•°]
æˆ–
alipays://platformapi/startapp?[å‚æ•°]
                                    <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                                </div>
                            </li>
                        </ol>
                    </div>
                </div>

                <div class="alert alert-success">
                    <strong>âœ… æ¨èå·¥å…·</strong><br>
                    â€¢ åœ¨çº¿äºŒç»´ç è§£æï¼š<a href="https://cli.im/deqr" target="_blank">è‰æ–™äºŒç»´ç </a><br>
                    â€¢ æ‰‹æœºåº”ç”¨ï¼šå¾®ä¿¡æ‰«ä¸€æ‰«ã€æ”¯ä»˜å®æ‰«ä¸€æ‰«<br>
                    â€¢ æµè§ˆå™¨æ’ä»¶ï¼šQR Code Reader
                </div>

                <div class="qr-preview">
                    <div class="qr-item">
                        <div class="qr-placeholder">
                            å¾®ä¿¡æ”¶æ¬¾ç <br>é¢„è§ˆåŒºåŸŸ
                        </div>
                        <input type="file" id="wechatQRFile" accept="image/*" onchange="previewQR(this, 'wechat')" style="margin-top: 10px;">
                        <div id="wechatQRData" style="margin-top: 10px; font-family: monospace; font-size: 0.8em; color: #666;"></div>
                    </div>

                    <div class="qr-item">
                        <div class="qr-placeholder">
                            æ”¯ä»˜å®æ”¶æ¬¾ç <br>é¢„è§ˆåŒºåŸŸ
                        </div>
                        <input type="file" id="alipayQRFile" accept="image/*" onchange="previewQR(this, 'alipay')" style="margin-top: 10px;">
                        <div id="alipayQRData" style="margin-top: 10px; font-family: monospace; font-size: 0.8em; color: #666;"></div>
                    </div>
                </div>

                <button class="btn btn-success" onclick="nextStep()">ä¸‹ä¸€æ­¥ï¼šé…ç½®æ›¿æ¢ â†’</button>
            </div>
        </div>

        <!-- æ­¥éª¤2ï¼šé…ç½®æ›¿æ¢æŒ‡å— -->
        <div id="step2" class="tab-content">
            <div class="card">
                <h2><span style="font-size: 1.5em;">âš™ï¸</span>é…ç½®æ›¿æ¢æŒ‡å—</h2>

                <div class="alert alert-info">
                    <strong>ğŸ“ é…ç½®æ–‡ä»¶ä½ç½®</strong><br>
                    æ‚¨éœ€è¦ç¼–è¾‘é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ <span class="highlight">.env.local</span> æ–‡ä»¶
                </div>

                <h3>ğŸ”§ å½“å‰é…ç½®çŠ¶æ€</h3>
                <div class="code-block" data-lang="env">
# å½“å‰ç¤ºä¾‹é…ç½®ï¼ˆéœ€è¦æ›¿æ¢ï¼‰
WECHAT_PERSONAL_QR_CODE=wxp://f2f0example_wechat_qr_code_data_for_testing
ALIPAY_PERSONAL_QR_CODE=https://qr.alipay.com/fkx123456789example_alipay_qr_code_data
                    <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                </div>

                <h3>ğŸ“ é…ç½®ç¼–è¾‘å™¨</h3>
                <div class="config-editor">
                    <label class="config-label">ğŸŸ¢ å¾®ä¿¡æ”¶æ¬¾ç æ•°æ®</label>
                    <input type="text" class="config-input" id="wechatQRInput"
                           placeholder="ç²˜è´´æ‚¨çš„å¾®ä¿¡æ”¶æ¬¾ç æ•°æ®ï¼Œæ ¼å¼å¦‚ï¼šwxp://f2f0..."
                           oninput="updateConfig()">

                    <label class="config-label">ğŸŸ¢ å¾®ä¿¡æ”¶æ¬¾äººå§“å</label>
                    <input type="text" class="config-input" id="wechatNameInput"
                           value="æ™ºæ¸¸åŠ©æ‰‹æ”¶æ¬¾ä¸“ç”¨"
                           oninput="updateConfig()">

                    <label class="config-label">ğŸŸ¢ å¾®ä¿¡æ”¶æ¬¾è´¦æˆ·</label>
                    <input type="text" class="config-input" id="wechatAccountInput"
                           value="smart_travel_wechat_2024"
                           oninput="updateConfig()">

                    <label class="config-label">ğŸ”µ æ”¯ä»˜å®æ”¶æ¬¾ç æ•°æ®</label>
                    <input type="text" class="config-input" id="alipayQRInput"
                           placeholder="ç²˜è´´æ‚¨çš„æ”¯ä»˜å®æ”¶æ¬¾ç æ•°æ®ï¼Œæ ¼å¼å¦‚ï¼šhttps://qr.alipay.com/..."
                           oninput="updateConfig()">

                    <label class="config-label">ğŸ”µ æ”¯ä»˜å®æ”¶æ¬¾äººå§“å</label>
                    <input type="text" class="config-input" id="alipayNameInput"
                           value="æ™ºæ¸¸åŠ©æ‰‹æ”¯ä»˜å®æ”¶æ¬¾"
                           oninput="updateConfig()">

                    <label class="config-label">ğŸ”µ æ”¯ä»˜å®æ”¶æ¬¾è´¦æˆ·</label>
                    <input type="text" class="config-input" id="alipayAccountInput"
                           value="smart_travel_alipay_2024"
                           oninput="updateConfig()">

                    <label class="config-label">ğŸ’° å•ç¬”æœ€å¤§é‡‘é¢ï¼ˆå…ƒï¼‰</label>
                    <input type="number" class="config-input" id="maxAmountInput"
                           value="300" min="1" max="1000"
                           oninput="updateConfig()">

                    <label class="config-label">ğŸ’° æ—¥é™é¢ï¼ˆå…ƒï¼‰</label>
                    <input type="number" class="config-input" id="dailyLimitInput"
                           value="3000" min="100" max="10000"
                           oninput="updateConfig()">
                </div>

                <h3>ğŸ“‹ ç”Ÿæˆçš„é…ç½®ä»£ç </h3>
                <div class="code-block" data-lang="env" id="generatedConfig">
# ç­‰å¾…æ‚¨è¾“å…¥é…ç½®ä¿¡æ¯...
                    <button class="copy-btn" onclick="copyGeneratedConfig()">å¤åˆ¶é…ç½®</button>
                </div>

                <div class="alert alert-warning">
                    <strong>âš ï¸ é…ç½®æ­¥éª¤</strong><br>
                    1. åœ¨ä¸Šæ–¹ç¼–è¾‘å™¨ä¸­è¾“å…¥æ‚¨çš„çœŸå®æ”¶æ¬¾ç æ•°æ®<br>
                    2. ç‚¹å‡»"å¤åˆ¶é…ç½®"æŒ‰é’®<br>
                    3. æ‰“å¼€é¡¹ç›®çš„ <code>.env.local</code> æ–‡ä»¶<br>
                    4. æ‰¾åˆ°QRæ”¯ä»˜é…ç½®éƒ¨åˆ†ï¼Œæ›¿æ¢å¯¹åº”çš„é…ç½®é¡¹<br>
                    5. ä¿å­˜æ–‡ä»¶
                </div>

                <button class="btn btn-warning" onclick="validateConfig()">éªŒè¯é…ç½®</button>
                <button class="btn btn-success" onclick="nextStep()">ä¸‹ä¸€æ­¥ï¼šé›†æˆæµ‹è¯• â†’</button>

                <div id="configValidation" class="validation-result"></div>
            </div>
        </div>

        <!-- æ­¥éª¤3ï¼šå¼€å‘ç¯å¢ƒé›†æˆæµ‹è¯• -->
        <div id="step3" class="tab-content">
            <div class="card">
                <h2><span style="font-size: 1.5em;">ğŸ§ª</span>å¼€å‘ç¯å¢ƒé›†æˆæµ‹è¯•</h2>

                <div class="alert alert-success">
                    <strong>ğŸ¯ æµ‹è¯•ç›®æ ‡</strong><br>
                    éªŒè¯çœŸå®æ”¶æ¬¾ç é…ç½®æ˜¯å¦æ­£ç¡®ï¼Œç¡®ä¿æ”¯ä»˜æµç¨‹èƒ½å¤Ÿæ­£å¸¸å·¥ä½œ
                </div>

                <h3>1ï¸âƒ£ é…ç½®éªŒè¯æµ‹è¯•</h3>
                <div class="code-block" data-lang="bash">
# è¿è¡ŒQRæ”¯ä»˜é…ç½®éªŒè¯
npx tsx scripts/qr-payment-config-validator.ts
                    <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                </div>

                <div class="alert alert-info">
                    <strong>âœ… é¢„æœŸç»“æœ</strong>ï¼šQRæ”¯ä»˜é…ç½®å°±ç»ªåº¦åº”è¯¥è¾¾åˆ° 90%+
                </div>

                <h3>2ï¸âƒ£ JWTè®¤è¯ç³»ç»ŸéªŒè¯</h3>
                <div class="code-block" data-lang="bash">
# éªŒè¯JWTè®¤è¯ç³»ç»Ÿä¸QRæ”¯ä»˜çš„é›†æˆ
npx tsx scripts/jwt-production-check.ts
                    <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                </div>

                <h3>3ï¸âƒ£ ç«¯åˆ°ç«¯æ”¯ä»˜æµç¨‹æµ‹è¯•</h3>
                <div class="code-block" data-lang="bash">
# è¿è¡Œå®Œæ•´çš„æ”¯ä»˜æµç¨‹æµ‹è¯•
npx playwright test tests/e2e/qr-payment-flow.spec.ts
                    <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                </div>

                <h3>4ï¸âƒ£ å¼€å‘æœåŠ¡å™¨å¯åŠ¨æµ‹è¯•</h3>
                <div class="code-block" data-lang="bash">
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# è®¿é—®æ”¯ä»˜é¡µé¢æµ‹è¯•
# http://localhost:3004/payment
                    <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                </div>

                <h3>ğŸ” æ‰‹åŠ¨æµ‹è¯•æ­¥éª¤</h3>
                <ol class="step-list">
                    <li>
                        <strong>å¯åŠ¨å¼€å‘æœåŠ¡å™¨</strong>
                        <p>è¿è¡Œ <code>npm run dev</code> å¯åŠ¨é¡¹ç›®</p>
                    </li>

                    <li>
                        <strong>è®¿é—®æ”¯ä»˜é¡µé¢</strong>
                        <p>åœ¨æµè§ˆå™¨ä¸­è®¿é—® <code>http://localhost:3004/payment</code></p>
                    </li>

                    <li>
                        <strong>åˆ›å»ºæµ‹è¯•è®¢å•</strong>
                        <p>é€‰æ‹©æ”¯ä»˜æ–¹å¼ï¼ˆå¾®ä¿¡æˆ–æ”¯ä»˜å®ï¼‰ï¼Œè¾“å…¥å°é¢æµ‹è¯•é‡‘é¢ï¼ˆå¦‚1å…ƒï¼‰</p>
                    </li>

                    <li>
                        <strong>éªŒè¯æ”¶æ¬¾ç æ˜¾ç¤º</strong>
                        <p>ç¡®è®¤æ˜¾ç¤ºçš„æ˜¯æ‚¨é…ç½®çš„çœŸå®æ”¶æ¬¾ç ï¼Œè€Œä¸æ˜¯ç¤ºä¾‹æ•°æ®</p>
                    </li>

                    <li>
                        <strong>æµ‹è¯•æ”¯ä»˜æµç¨‹</strong>
                        <p>ä½¿ç”¨æ‰‹æœºæ‰«ç ï¼Œå®Œæˆå°é¢æµ‹è¯•æ”¯ä»˜ï¼ŒéªŒè¯æ•´ä¸ªæµç¨‹</p>
                    </li>
                </ol>

                <div class="alert alert-warning">
                    <strong>ğŸ’¡ æµ‹è¯•å»ºè®®</strong><br>
                    â€¢ ä½¿ç”¨å°é¢é‡‘é¢æµ‹è¯•ï¼ˆ1-5å…ƒï¼‰<br>
                    â€¢ æµ‹è¯•å®Œæˆåå¯ä»¥é€šè¿‡æ”¯ä»˜å¹³å°é€€æ¬¾<br>
                    â€¢ è®°å½•æµ‹è¯•è¿‡ç¨‹ä¸­çš„ä»»ä½•é”™è¯¯ä¿¡æ¯<br>
                    â€¢ éªŒè¯æ”¯ä»˜å‡­è¯ä¸Šä¼ åŠŸèƒ½æ˜¯å¦æ­£å¸¸
                </div>

                <button class="btn btn-success" onclick="runAllTests()">ğŸš€ è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
                <button class="btn btn-success" onclick="nextStep()">ä¸‹ä¸€æ­¥ï¼šå®‰å…¨æ³¨æ„ â†’</button>
            </div>
        </div>

        <!-- æ­¥éª¤4ï¼šå®‰å…¨æ³¨æ„äº‹é¡¹ -->
        <div id="step4" class="tab-content">
            <div class="card">
                <h2><span style="font-size: 1.5em;">ğŸ›¡ï¸</span>å®‰å…¨æ³¨æ„äº‹é¡¹</h2>

                <div class="alert alert-danger">
                    <strong>ğŸš¨ é‡è¦å®‰å…¨æé†’</strong><br>
                    ä¸ªäººæ”¶æ¬¾ç æ¶‰åŠçœŸå®èµ„é‡‘ï¼Œè¯·åŠ¡å¿…éµå¾ªå®‰å…¨ä½¿ç”¨è§„èŒƒ
                </div>

                <h3>ğŸ”’ ä¸ªäººæ”¶æ¬¾ç å®‰å…¨ä½¿ç”¨è§„èŒƒ</h3>
                <div class="two-column">
                    <div>
                        <h4 style="color: #27ae60;">âœ… å®‰å…¨åšæ³•</h4>
                        <ul style="list-style-type: none; padding: 0;">
                            <li style="margin: 10px 0; padding: 10px; background: #eafaf1; border-radius: 5px;">
                                âœ… ä»…ç”¨äºå°é¢æ”¶æ¬¾ï¼ˆå»ºè®®å•ç¬”ä¸è¶…è¿‡500å…ƒï¼‰
                            </li>
                            <li style="margin: 10px 0; padding: 10px; background: #eafaf1; border-radius: 5px;">
                                âœ… å®šæœŸæ›´æ¢æ”¶æ¬¾ç ï¼ˆå»ºè®®æ¯æœˆæ›´æ¢ï¼‰
                            </li>
                            <li style="margin: 10px 0; padding: 10px; background: #eafaf1; border-radius: 5px;">
                                âœ… ä¿ç•™æ‰€æœ‰äº¤æ˜“è®°å½•å’Œæ”¯ä»˜å‡­è¯
                            </li>
                            <li style="margin: 10px 0; padding: 10px; background: #eafaf1; border-radius: 5px;">
                                âœ… è®¾ç½®åˆç†çš„é‡‘é¢é™åˆ¶å’Œæ—¥é™é¢
                            </li>
                            <li style="margin: 10px 0; padding: 10px; background: #eafaf1; border-radius: 5px;">
                                âœ… åŠæ—¶å¤„ç†ç”¨æˆ·çš„æ”¯ä»˜éªŒè¯è¯·æ±‚
                            </li>
                        </ul>
                    </div>

                    <div>
                        <h4 style="color: #e74c3c;">âŒ é£é™©è¡Œä¸º</h4>
                        <ul style="list-style-type: none; padding: 0;">
                            <li style="margin: 10px 0; padding: 10px; background: #fdeaea; border-radius: 5px;">
                                âŒ åœ¨å…¬å¼€åœºæ‰€å±•ç¤ºæ”¶æ¬¾ç 
                            </li>
                            <li style="margin: 10px 0; padding: 10px; background: #fdeaea; border-radius: 5px;">
                                âŒ å°†æ”¶æ¬¾ç æ•°æ®å­˜å‚¨åœ¨ä¸å®‰å…¨çš„åœ°æ–¹
                            </li>
                            <li style="margin: 10px 0; padding: 10px; background: #fdeaea; border-radius: 5px;">
                                âŒ ç”¨äºå¤§é¢äº¤æ˜“æˆ–å•†ä¸šç”¨é€”
                            </li>
                            <li style="margin: 10px 0; padding: 10px; background: #fdeaea; border-radius: 5px;">
                                âŒ å¿½ç•¥å¼‚å¸¸çš„æ”¯ä»˜è¯·æ±‚
                            </li>
                            <li style="margin: 10px 0; padding: 10px; background: #fdeaea; border-radius: 5px;">
                                âŒ ä¸é™Œç”Ÿäººåˆ†äº«æ”¶æ¬¾ç ä¿¡æ¯
                            </li>
                        </ul>
                    </div>
                </div>

                <h3>ğŸ—ï¸ å¼€å‘ç¯å¢ƒä¸ç”Ÿäº§ç¯å¢ƒé…ç½®åŒºåˆ«</h3>
                <div class="code-block" data-lang="env">
# å¼€å‘ç¯å¢ƒé…ç½® (.env.local)
NODE_ENV=development
QR_PAYMENT_ENABLED=true
WECHAT_PERSONAL_MAX_AMOUNT=30000  # 300å…ƒï¼Œé€‚åˆæµ‹è¯•
ALIPAY_PERSONAL_MAX_AMOUNT=30000

# ç”Ÿäº§ç¯å¢ƒé…ç½® (.env.production)
NODE_ENV=production
QR_PAYMENT_ENABLED=true
WECHAT_PERSONAL_MAX_AMOUNT=50000  # 500å…ƒï¼Œç”Ÿäº§é™åˆ¶
ALIPAY_PERSONAL_MAX_AMOUNT=50000
# ç”Ÿäº§ç¯å¢ƒåº”ä½¿ç”¨ä¸åŒçš„æ”¶æ¬¾ç 
                    <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                </div>

                <h3>ğŸ” æ”¶æ¬¾ç æ³„éœ²é£é™©é˜²èŒƒ</h3>
                <div class="alert alert-warning">
                    <strong>âš ï¸ å¦‚æœæ”¶æ¬¾ç æ³„éœ²ï¼Œè¯·ç«‹å³ï¼š</strong><br>
                    1. æ›´æ¢æ–°çš„æ”¶æ¬¾ç <br>
                    2. æ›´æ–°é¡¹ç›®é…ç½®<br>
                    3. æ£€æŸ¥æ˜¯å¦æœ‰å¼‚å¸¸äº¤æ˜“<br>
                    4. é€šçŸ¥ç›¸å…³ç”¨æˆ·ç³»ç»Ÿç»´æŠ¤
                </div>

                <h3>ğŸ“Š ç›‘æ§å’Œå®¡è®¡</h3>
                <div class="code-block" data-lang="javascript">
// å»ºè®®æ·»åŠ çš„ç›‘æ§ä»£ç 
const paymentMonitor = {
  // è®°å½•æ‰€æœ‰æ”¯ä»˜è¯·æ±‚
  logPaymentRequest: (orderId, amount, userId) => {
    console.log(`Payment Request: ${orderId}, Amount: ${amount}, User: ${userId}`);
  },

  // ç›‘æ§å¼‚å¸¸é‡‘é¢
  checkAbnormalAmount: (amount) => {
    const maxAmount = parseInt(process.env.WECHAT_PERSONAL_MAX_AMOUNT) || 50000;
    if (amount > maxAmount) {
      console.warn(`Abnormal payment amount detected: ${amount}`);
      return false;
    }
    return true;
  }
};
                    <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                </div>

                <button class="btn btn-success" onclick="nextStep()">ä¸‹ä¸€æ­¥ï¼šæ•…éšœæ’é™¤ â†’</button>
            </div>
        </div>

        <!-- æ­¥éª¤5ï¼šæ•…éšœæ’é™¤ -->
        <div id="step5" class="tab-content">
            <div class="card">
                <h2><span style="font-size: 1.5em;">ğŸ”§</span>æ•…éšœæ’é™¤</h2>

                <h3>ğŸš¨ å¸¸è§é…ç½®é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ</h3>

                <div class="troubleshoot-item">
                    <h4>âŒ é—®é¢˜ï¼šQRæ”¯ä»˜é…ç½®éªŒè¯å¤±è´¥</h4>
                    <p><strong>ç—‡çŠ¶</strong>ï¼šè¿è¡ŒéªŒè¯è„šæœ¬æ—¶æ˜¾ç¤ºé…ç½®å°±ç»ªåº¦ä½äº80%</p>
                    <p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
                    <div class="code-block" data-lang="bash">
# 1. æ£€æŸ¥ç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®åŠ è½½
echo $QR_PAYMENT_ENABLED

# 2. é‡æ–°è¿è¡Œé…ç½®ä¿®å¤è„šæœ¬
npx tsx scripts/fix-qr-payment-config.ts

# 3. éªŒè¯é…ç½®æ–‡ä»¶æ ¼å¼
cat .env.local | grep QR_PAYMENT
                        <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                    </div>
                </div>

                <div class="troubleshoot-item">
                    <h4>âŒ é—®é¢˜ï¼šæ”¶æ¬¾ç æ•°æ®æ ¼å¼é”™è¯¯</h4>
                    <p><strong>ç—‡çŠ¶</strong>ï¼šæ”¯ä»˜é¡µé¢æ˜¾ç¤ºé”™è¯¯æˆ–æ— æ³•ç”ŸæˆäºŒç»´ç </p>
                    <p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
                    <div class="code-block" data-lang="text">
æ­£ç¡®çš„æ”¶æ¬¾ç æ ¼å¼ï¼š
å¾®ä¿¡ï¼šwxp://f2f0[å­—ç¬¦ä¸²] æˆ– weixin://wxpay/bizpayurl?pr=[å‚æ•°]
æ”¯ä»˜å®ï¼šhttps://qr.alipay.com/[å‚æ•°] æˆ– alipays://platformapi/startapp?[å‚æ•°]

é”™è¯¯æ ¼å¼ç¤ºä¾‹ï¼š
âŒ å›¾ç‰‡æ–‡ä»¶è·¯å¾„ï¼š/path/to/qr_code.png
âŒ Base64å›¾ç‰‡æ•°æ®ï¼šdata:image/png;base64,iVBORw0KG...
âŒ ä¸å®Œæ•´çš„URLï¼šqr.alipay.com/abc
                        <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                    </div>
                </div>

                <div class="troubleshoot-item">
                    <h4>âŒ é—®é¢˜ï¼šæ”¯ä»˜æœåŠ¡åˆå§‹åŒ–å¤±è´¥</h4>
                    <p><strong>ç—‡çŠ¶</strong>ï¼šå¯åŠ¨é¡¹ç›®æ—¶å‡ºç°"QRPaymentServiceåˆå§‹åŒ–å¤±è´¥"é”™è¯¯</p>
                    <p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
                    <div class="code-block" data-lang="bash">
# 1. æ£€æŸ¥ä¾èµ–æ˜¯å¦å®‰è£…å®Œæ•´
npm install

# 2. æ¸…ç†ç¼“å­˜é‡æ–°å®‰è£…
rm -rf node_modules package-lock.json
npm install

# 3. æ£€æŸ¥TypeScriptç¼–è¯‘
npx tsc --noEmit
                        <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                    </div>
                </div>

                <div class="troubleshoot-item">
                    <h4>âŒ é—®é¢˜ï¼šJWTè®¤è¯ä¸QRæ”¯ä»˜é›†æˆå¤±è´¥</h4>
                    <p><strong>ç—‡çŠ¶</strong>ï¼šæ”¯ä»˜è¯·æ±‚è¿”å›401æœªæˆæƒé”™è¯¯</p>
                    <p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
                    <div class="code-block" data-lang="bash">
# 1. éªŒè¯JWTé…ç½®
npx tsx scripts/jwt-production-check.ts

# 2. æ£€æŸ¥JWTå¯†é’¥é…ç½®
echo $JWT_ACCESS_SECRET
echo $JWT_REFRESH_SECRET

# 3. é‡æ–°ç”ŸæˆJWTå¯†é’¥ï¼ˆå¦‚æœéœ€è¦ï¼‰
openssl rand -base64 32
                        <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                    </div>
                </div>

                <h3>ğŸ” æ”¶æ¬¾ç æ— æ•ˆæ—¶çš„å¤„ç†æ–¹æ³•</h3>
                <ol class="step-list">
                    <li>
                        <strong>éªŒè¯æ”¶æ¬¾ç æœ‰æ•ˆæ€§</strong>
                        <p>ä½¿ç”¨æ‰‹æœºæ‰«ç æµ‹è¯•ï¼Œç¡®è®¤æ”¶æ¬¾ç å¯ä»¥æ­£å¸¸ä½¿ç”¨</p>
                    </li>

                    <li>
                        <strong>æ£€æŸ¥æ•°æ®æ ¼å¼</strong>
                        <p>ç¡®ä¿å¤åˆ¶çš„æ˜¯å®Œæ•´çš„URLæˆ–åè®®æ•°æ®ï¼Œä¸æ˜¯å›¾ç‰‡è·¯å¾„</p>
                    </li>

                    <li>
                        <strong>é‡æ–°è·å–æ”¶æ¬¾ç </strong>
                        <p>å¦‚æœæ”¶æ¬¾ç è¿‡æœŸï¼Œé‡æ–°ç”Ÿæˆæ–°çš„æ”¶æ¬¾ç </p>
                    </li>

                    <li>
                        <strong>æ›´æ–°é…ç½®æ–‡ä»¶</strong>
                        <p>å°†æ–°çš„æ”¶æ¬¾ç æ•°æ®æ›´æ–°åˆ°.env.localæ–‡ä»¶ä¸­</p>
                    </li>
                </ol>

                <h3>ğŸ§ª æ”¯ä»˜æµ‹è¯•å¤±è´¥çš„è°ƒè¯•æ­¥éª¤</h3>
                <div class="code-block" data-lang="bash">
# 1. å¯ç”¨è¯¦ç»†æ—¥å¿—
export LOG_LEVEL=DEBUG
npm run dev

# 2. æ£€æŸ¥æ”¯ä»˜æœåŠ¡çŠ¶æ€
curl -X GET http://localhost:3004/api/payment/status

# 3. æµ‹è¯•æ”¯ä»˜è®¢å•åˆ›å»º
curl -X POST http://localhost:3004/api/payment/create-order \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -d '{"orderId":"test123","amount":100,"paymentMethod":"wechat"}'

# 4. æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—
tail -f logs/payment.log
                    <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                </div>

                <h3>ğŸ“ è·å–å¸®åŠ©</h3>
                <div class="alert alert-info">
                    <strong>ğŸ’¡ å¦‚æœé—®é¢˜ä»æœªè§£å†³</strong><br>
                    1. æŸ¥çœ‹é¡¹ç›®æ–‡æ¡£ï¼š<code>docs/QR_PAYMENT_SOLUTION.md</code><br>
                    2. è¿è¡Œå®Œæ•´çš„é…ç½®éªŒè¯ï¼š<code>npx tsx scripts/qr-payment-config-validator.ts</code><br>
                    3. æ£€æŸ¥GitHub Issuesæˆ–æäº¤æ–°çš„é—®é¢˜æŠ¥å‘Š<br>
                    4. è”ç³»æŠ€æœ¯æ”¯æŒå›¢é˜Ÿ
                </div>

                <button class="btn btn-success" onclick="completeSetup()">ğŸ‰ å®Œæˆé…ç½®</button>
            </div>
        </div>

        <!-- å®Œæˆé¡µé¢ -->
        <div id="complete" class="tab-content">
            <div class="card" style="text-align: center;">
                <h2><span style="font-size: 2em;">ğŸ‰</span>é…ç½®å®Œæˆï¼</h2>

                <div style="font-size: 1.2em; color: #27ae60; margin: 30px 0;">
                    <strong>æ­å–œï¼æ‚¨å·²æˆåŠŸé…ç½®çœŸå®æ”¶æ¬¾ç </strong>
                </div>

                <div class="alert alert-success">
                    <strong>âœ… é…ç½®å®Œæˆæ¸…å•</strong><br>
                    â€¢ è·å–äº†çœŸå®çš„å¾®ä¿¡å’Œæ”¯ä»˜å®æ”¶æ¬¾ç <br>
                    â€¢ æ›´æ–°äº†.env.localé…ç½®æ–‡ä»¶<br>
                    â€¢ é€šè¿‡äº†é…ç½®éªŒè¯æµ‹è¯•<br>
                    â€¢ äº†è§£äº†å®‰å…¨ä½¿ç”¨è§„èŒƒ<br>
                    â€¢ æŒæ¡äº†æ•…éšœæ’é™¤æ–¹æ³•
                </div>

                <h3>ğŸš€ ä¸‹ä¸€æ­¥è¡ŒåŠ¨</h3>
                <div style="display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; margin: 30px 0;">
                    <button class="btn btn-success" onclick="runFinalValidation()">
                        ğŸ” æœ€ç»ˆéªŒè¯
                    </button>
                    <button class="btn" onclick="startDevelopment()">
                        ğŸ’» å¼€å§‹å¼€å‘
                    </button>
                    <button class="btn btn-warning" onclick="viewDocumentation()">
                        ğŸ“š æŸ¥çœ‹æ–‡æ¡£
                    </button>
                </div>

                <div class="alert alert-info">
                    <strong>ğŸ“‹ è®°ä½è¦ç‚¹</strong><br>
                    â€¢ å®šæœŸæ£€æŸ¥æ”¶æ¬¾ç æœ‰æ•ˆæ€§<br>
                    â€¢ ç›‘æ§æ”¯ä»˜äº¤æ˜“è®°å½•<br>
                    â€¢ åŠæ—¶å¤„ç†ç”¨æˆ·æ”¯ä»˜éªŒè¯<br>
                    â€¢ å‡†å¤‡å‡çº§åˆ°MCPåè®®
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentStep = 1;
        const totalSteps = 5;

        function showTab(tabId) {
            // éšè—æ‰€æœ‰æ ‡ç­¾å†…å®¹
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // ç§»é™¤æ‰€æœ‰æ ‡ç­¾çš„activeç±»
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾å†…å®¹
            document.getElementById(tabId).classList.add('active');

            // æ·»åŠ activeç±»åˆ°é€‰ä¸­çš„æ ‡ç­¾
            event.target.closest('.nav-tab').classList.add('active');

            // æ›´æ–°è¿›åº¦
            const stepNumber = parseInt(tabId.replace('step', ''));
            updateProgress(stepNumber);
        }

        function nextStep() {
            if (currentStep < totalSteps) {
                currentStep++;
                showTab(`step${currentStep}`);

                // æ›´æ–°æ ‡ç­¾activeçŠ¶æ€
                document.querySelectorAll('.nav-tab').forEach((tab, index) => {
                    tab.classList.remove('active');
                    if (index === currentStep - 1) {
                        tab.classList.add('active');
                    }
                });
            } else {
                // æ˜¾ç¤ºå®Œæˆé¡µé¢
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById('complete').classList.add('active');
                updateProgress(totalSteps + 1);
            }
        }

        function updateProgress(step) {
            const progress = (step / (totalSteps + 1)) * 100;
            document.getElementById('progressBar').style.width = progress + '%';

            const messages = [
                'å‡†å¤‡å¼€å§‹é…ç½®...',
                'æ­£åœ¨è·å–æ”¶æ¬¾ç ...',
                'æ­£åœ¨é…ç½®æ›¿æ¢...',
                'æ­£åœ¨é›†æˆæµ‹è¯•...',
                'æ­£åœ¨æ£€æŸ¥å®‰å…¨...',
                'æ­£åœ¨æ•…éšœæ’é™¤...',
                'é…ç½®å®Œæˆï¼ğŸ‰'
            ];

            document.getElementById('progressText').textContent = messages[step] || messages[0];
        }

        function copyCode(button) {
            const codeBlock = button.parentElement;
            const code = codeBlock.textContent.replace('å¤åˆ¶', '').trim();

            navigator.clipboard.writeText(code).then(() => {
                button.textContent = 'å·²å¤åˆ¶!';
                button.style.background = '#27ae60';
                setTimeout(() => {
                    button.textContent = 'å¤åˆ¶';
                    button.style.background = '#27ae60';
                }, 2000);
            });
        }

        function updateConfig() {
            const wechatQR = document.getElementById('wechatQRInput').value;
            const wechatName = document.getElementById('wechatNameInput').value;
            const wechatAccount = document.getElementById('wechatAccountInput').value;
            const alipayQR = document.getElementById('alipayQRInput').value;
            const alipayName = document.getElementById('alipayNameInput').value;
            const alipayAccount = document.getElementById('alipayAccountInput').value;
            const maxAmount = document.getElementById('maxAmountInput').value;
            const dailyLimit = document.getElementById('dailyLimitInput').value;

            const config = `# QRæ”¯ä»˜é…ç½® - æ›´æ–°äº ${new Date().toISOString()}
# ============================================================================
# QRæ”¯ä»˜é…ç½® (ä¸ªäººæ”¶æ¬¾ç ) - çœŸå®æ”¶æ¬¾ç é…ç½®
# ============================================================================

# å¯ç”¨QRæ”¯ä»˜
QR_PAYMENT_ENABLED=true

# å¾®ä¿¡ä¸ªäººæ”¶æ¬¾ç é…ç½®
WECHAT_PERSONAL_QR_ENABLED=true
WECHAT_PERSONAL_QR_CODE=${wechatQR || 'your_wechat_personal_qr_code_data'}
WECHAT_PAYEE_NAME=${wechatName}
WECHAT_PAYEE_ACCOUNT=${wechatAccount}
WECHAT_PAYEE_AVATAR=https://example.com/wechat-avatar.jpg
WECHAT_PERSONAL_MAX_AMOUNT=${maxAmount * 100}
WECHAT_PERSONAL_DAILY_LIMIT=${dailyLimit * 100}

# æ”¯ä»˜å®ä¸ªäººæ”¶æ¬¾ç é…ç½®
ALIPAY_PERSONAL_QR_ENABLED=true
ALIPAY_PERSONAL_QR_CODE=${alipayQR || 'your_alipay_personal_qr_code_data'}
ALIPAY_PAYEE_NAME=${alipayName}
ALIPAY_PAYEE_ACCOUNT=${alipayAccount}
ALIPAY_PAYEE_AVATAR=https://example.com/alipay-avatar.jpg
ALIPAY_PERSONAL_MAX_AMOUNT=${maxAmount * 100}
ALIPAY_PERSONAL_DAILY_LIMIT=${dailyLimit * 100}`;

            document.getElementById('generatedConfig').textContent = config;
        }

        function copyGeneratedConfig() {
            const config = document.getElementById('generatedConfig').textContent;
            navigator.clipboard.writeText(config).then(() => {
                alert('âœ… é…ç½®å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼\n\nè¯·æ‰“å¼€ .env.local æ–‡ä»¶ï¼Œæ‰¾åˆ°QRæ”¯ä»˜é…ç½®éƒ¨åˆ†ï¼Œæ›¿æ¢ç›¸åº”çš„é…ç½®é¡¹ã€‚');
            });
        }

        function validateConfig() {
            const wechatQR = document.getElementById('wechatQRInput').value;
            const alipayQR = document.getElementById('alipayQRInput').value;

            const validation = document.getElementById('configValidation');
            validation.classList.add('show');

            let isValid = true;
            let message = '<h4>ğŸ” é…ç½®éªŒè¯ç»“æœ</h4>';

            if (!wechatQR || wechatQR.includes('example')) {
                message += '<p>âŒ å¾®ä¿¡æ”¶æ¬¾ç ä»ä½¿ç”¨ç¤ºä¾‹æ•°æ®</p>';
                isValid = false;
            } else if (wechatQR.startsWith('wxp://') || wechatQR.startsWith('weixin://')) {
                message += '<p>âœ… å¾®ä¿¡æ”¶æ¬¾ç æ ¼å¼æ­£ç¡®</p>';
            } else {
                message += '<p>âš ï¸ å¾®ä¿¡æ”¶æ¬¾ç æ ¼å¼å¯èƒ½ä¸æ­£ç¡®</p>';
            }

            if (!alipayQR || alipayQR.includes('example')) {
                message += '<p>âŒ æ”¯ä»˜å®æ”¶æ¬¾ç ä»ä½¿ç”¨ç¤ºä¾‹æ•°æ®</p>';
                isValid = false;
            } else if (alipayQR.startsWith('https://qr.alipay.com/') || alipayQR.startsWith('alipays://')) {
                message += '<p>âœ… æ”¯ä»˜å®æ”¶æ¬¾ç æ ¼å¼æ­£ç¡®</p>';
            } else {
                message += '<p>âš ï¸ æ”¯ä»˜å®æ”¶æ¬¾ç æ ¼å¼å¯èƒ½ä¸æ­£ç¡®</p>';
            }

            if (isValid) {
                validation.className = 'validation-result show alert alert-success';
                message += '<p><strong>ğŸ‰ é…ç½®éªŒè¯é€šè¿‡ï¼å¯ä»¥è¿›è¡Œä¸‹ä¸€æ­¥æµ‹è¯•ã€‚</strong></p>';
            } else {
                validation.className = 'validation-result show alert alert-warning';
                message += '<p><strong>âš ï¸ è¯·å®Œå–„é…ç½®åå†è¿›è¡Œæµ‹è¯•ã€‚</strong></p>';
            }

            validation.innerHTML = message;
        }

        function previewQR(input, type) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    // è¿™é‡Œå¯ä»¥æ·»åŠ äºŒç»´ç è§£æé€»è¾‘
                    // ç›®å‰åªæ˜¯æ˜¾ç¤ºæç¤ºä¿¡æ¯
                    const dataDiv = document.getElementById(type + 'QRData');
                    dataDiv.innerHTML = `<small>å·²é€‰æ‹©æ–‡ä»¶: ${file.name}<br>è¯·ä½¿ç”¨äºŒç»´ç è§£æå·¥å…·è·å–æ•°æ®</small>`;
                };
                reader.readAsDataURL(file);
            }
        }

        function runAllTests() {
            alert('ğŸ§ª æµ‹è¯•æŒ‡å—ï¼š\n\n1. é¦–å…ˆè¿è¡Œï¼šnpx tsx scripts/qr-payment-config-validator.ts\n2. ç„¶åè¿è¡Œï¼šnpx tsx scripts/jwt-production-check.ts\n3. æœ€åè¿è¡Œï¼šnpx playwright test tests/e2e/qr-payment-flow.spec.ts\n\nè¯·åœ¨ç»ˆç«¯ä¸­ä¾æ¬¡æ‰§è¡Œè¿™äº›å‘½ä»¤ã€‚');
        }

        function completeSetup() {
            nextStep(); // æ˜¾ç¤ºå®Œæˆé¡µé¢
        }

        function runFinalValidation() {
            alert('ğŸ” æœ€ç»ˆéªŒè¯ï¼š\n\nè¯·åœ¨ç»ˆç«¯ä¸­è¿è¡Œï¼š\nnpx tsx scripts/qr-payment-config-validator.ts\n\nç¡®ä¿é…ç½®å°±ç»ªåº¦è¾¾åˆ°90%ä»¥ä¸Šã€‚');
        }

        function startDevelopment() {
            alert('ğŸ’» å¼€å§‹å¼€å‘ï¼š\n\n1. è¿è¡Œï¼šnpm run dev\n2. è®¿é—®ï¼šhttp://localhost:3004\n3. æµ‹è¯•æ”¯ä»˜åŠŸèƒ½\n\nç¥æ‚¨å¼€å‘é¡ºåˆ©ï¼');
        }

        function viewDocumentation() {
            alert('ğŸ“š ç›¸å…³æ–‡æ¡£ï¼š\n\nâ€¢ QRæ”¯ä»˜è§£å†³æ–¹æ¡ˆï¼šdocs/QR_PAYMENT_SOLUTION.md\nâ€¢ ä¿®å¤æŠ¥å‘Šï¼šdocs/QR_PAYMENT_FIX_REPORT.md\nâ€¢ å®æ–½æŒ‡å—ï¼šdocs/qr-payment-implementation-guide.html');
        }

        // åˆå§‹åŒ–
        updateProgress(1);
        updateConfig();
    </script>
</body>
</html>