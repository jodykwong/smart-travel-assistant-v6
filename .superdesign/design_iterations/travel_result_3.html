<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—…è¡Œè§„åˆ’ç»“æœ - æ™ºæ¸¸åŠ©æ‰‹v6.5</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand-primary': '#007AFF',
                        'brand-secondary': '#5856D6',
                        'surface': '#FFFFFF',
                        'surface-variant': '#F2F2F7',
                        'on-surface': '#1C1C1E',
                        'on-surface-variant': '#8E8E93',
                        'outline': '#C6C6C8',
                        'success': '#34C759',
                        'warning': '#FF9500',
                        'error': '#FF3B30'
                    },
                    spacing: {
                        '4': '16px',
                        '8': '32px',
                        '12': '48px',
                        '16': '64px',
                        '20': '80px',
                        '24': '96px'
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-up': 'slideUp 0.6s ease-out',
                        'scale-in': 'scaleIn 0.4s ease-out'
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes scaleIn {
            from { transform: scale(0.95); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .activity-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .activity-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0, 122, 255, 0.1);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-purple-50 to-indigo-50 min-h-screen">
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <nav class="glass-effect sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <button onclick="goBack()" class="flex items-center gap-2 px-4 py-2 rounded-2xl border border-outline/30 text-on-surface hover:bg-white/50 transition-all duration-300 backdrop-blur-sm">
                        <i class="fas fa-arrow-left"></i>
                        <span>è¿”å›</span>
                    </button>
                    <div>
                        <h1 id="planTitle" class="text-2xl font-bold bg-gradient-to-r from-brand-primary to-brand-secondary bg-clip-text text-transparent">åŠ è½½ä¸­...</h1>
                        <p id="planSubtitle" class="text-sm text-on-surface-variant">æ­£åœ¨è·å–è¡Œç¨‹ä¿¡æ¯</p>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <button class="p-3 rounded-2xl hover:bg-white/50 transition-all duration-300" title="åˆ†äº«è¡Œç¨‹">
                        <i class="fas fa-share-alt text-on-surface-variant"></i>
                    </button>
                    <button class="p-3 rounded-2xl hover:bg-white/50 transition-all duration-300" title="æ”¶è—è¡Œç¨‹">
                        <i class="fas fa-heart text-on-surface-variant"></i>
                    </button>
                    <button class="flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-brand-primary to-brand-secondary text-white rounded-2xl hover:shadow-lg hover:scale-105 transition-all duration-300">
                        <i class="fas fa-download"></i>
                        <span>å¯¼å‡ºè¡Œç¨‹</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <div class="max-w-7xl mx-auto px-4 py-8">
        <!-- åŠ è½½çŠ¶æ€ -->
        <div id="loadingState" class="flex items-center justify-center py-20">
            <div class="glass-effect rounded-3xl p-8 shadow-2xl text-center animate-scale-in">
                <div class="relative mb-6">
                    <div class="animate-spin rounded-full h-16 w-16 border-4 border-brand-primary/20 border-t-brand-primary mx-auto"></div>
                    <div class="absolute inset-0 rounded-full bg-gradient-to-r from-brand-primary/10 to-brand-secondary/10 animate-pulse"></div>
                </div>
                <h3 class="text-xl font-semibold text-on-surface mb-2">æ­£åœ¨åŠ è½½æ‚¨çš„ä¸“å±è¡Œç¨‹</h3>
                <p class="text-on-surface-variant">è¯·ç¨å€™ï¼Œæˆ‘ä»¬æ­£åœ¨ä¸ºæ‚¨å‡†å¤‡ç²¾å½©çš„æ—…ç¨‹...</p>
            </div>
        </div>

        <!-- é”™è¯¯çŠ¶æ€ -->
        <div id="errorState" class="hidden flex items-center justify-center py-20">
            <div class="glass-effect rounded-3xl p-8 shadow-2xl text-center max-w-md animate-scale-in">
                <div class="text-error mb-4">
                    <i class="fas fa-exclamation-triangle text-5xl"></i>
                </div>
                <h3 class="text-xl font-semibold text-on-surface mb-2">åŠ è½½å¤±è´¥</h3>
                <p id="errorMessage" class="text-on-surface-variant mb-6">æ— æ³•åŠ è½½è¡Œç¨‹æ•°æ®</p>
                <button onclick="retryLoad()" class="px-6 py-3 bg-gradient-to-r from-brand-primary to-brand-secondary text-white rounded-2xl hover:shadow-lg hover:scale-105 transition-all duration-300">
                    é‡æ–°åŠ è½½
                </button>
            </div>
        </div>

        <!-- ä¸»è¦å†…å®¹ -->
        <div id="mainContent" class="hidden animate-fade-in">
            <!-- è¡Œç¨‹æ¦‚è§ˆä»ªè¡¨æ¿ -->
            <div class="glass-effect rounded-3xl p-8 mb-8 shadow-lg animate-slide-up">
                <h2 class="text-2xl font-bold text-on-surface mb-6 text-center">è¡Œç¨‹æ¦‚è§ˆ</h2>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                    <div class="text-center p-4 rounded-2xl bg-gradient-to-br from-brand-primary/10 to-brand-primary/5 hover:from-brand-primary/20 hover:to-brand-primary/10 transition-all duration-300">
                        <div class="text-3xl font-bold text-brand-primary mb-2" id="totalDays">-</div>
                        <div class="text-sm text-on-surface-variant font-medium">æ€»å¤©æ•°</div>
                    </div>
                    <div class="text-center p-4 rounded-2xl bg-gradient-to-br from-brand-secondary/10 to-brand-secondary/5 hover:from-brand-secondary/20 hover:to-brand-secondary/10 transition-all duration-300">
                        <div class="text-3xl font-bold text-brand-secondary mb-2" id="totalCost">Â¥-</div>
                        <div class="text-sm text-on-surface-variant font-medium">é¢„ç®—è´¹ç”¨</div>
                    </div>
                    <div class="text-center p-4 rounded-2xl bg-gradient-to-br from-success/10 to-success/5 hover:from-success/20 hover:to-success/10 transition-all duration-300">
                        <div class="text-3xl font-bold text-success mb-2" id="groupSize">-</div>
                        <div class="text-sm text-on-surface-variant font-medium">å‡ºè¡Œäººæ•°</div>
                    </div>
                    <div class="text-center p-4 rounded-2xl bg-gradient-to-br from-warning/10 to-warning/5 hover:from-warning/20 hover:to-warning/10 transition-all duration-300">
                        <div class="text-3xl font-bold text-warning mb-2" id="activitiesCount">-</div>
                        <div class="text-sm text-on-surface-variant font-medium">ç²¾é€‰æ´»åŠ¨</div>
                    </div>
                </div>
            </div>

            <!-- ç½‘æ ¼å¸ƒå±€è¡Œç¨‹ -->
            <div id="gridLayout" class="space-y-8">
                <!-- åŠ¨æ€ç”Ÿæˆçš„ç½‘æ ¼é¡¹ç›®å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let sessionId = null;
        let planData = null;
        let demoMode = false;

        // æ¼”ç¤ºæ•°æ® - è‹å·ä¸»é¢˜
        const demoData = {
            id: 'demo_session_003',
            title: 'è‹å·5æ—¥å›­æ—é›…éŸµ',
            destination: 'è‹å·',
            totalDays: 5,
            startDate: '2025-09-01',
            endDate: '2025-09-05',
            totalCost: 3150,
            groupSize: 4,
            itinerary: [
                {
                    day: 1,
                    date: '9æœˆ1æ—¥ å‘¨æ—¥',
                    location: 'è‹å·å¤åŸåŒº',
                    weather: 'æ™´æœ—',
                    temperature: '26Â°C',
                    activities: [
                        {
                            time: '09:00-12:00',
                            title: 'æ‹™æ”¿å›­æ¸¸è§ˆ',
                            description: 'ä¸­å›½å››å¤§åå›­ä¹‹é¦–ï¼Œæ±Ÿå—å›­æ—çš„ä»£è¡¨ä½œã€‚æ¬£èµ"å’«å°ºä¹‹å†…å†é€ ä¹¾å¤"çš„é€ å›­è‰ºæœ¯ï¼Œæ„Ÿå—æ–‡äººé›…å£«çš„ç”Ÿæ´»æƒ…è¶£ã€‚',
                            icon: 'ğŸï¸',
                            cost: 90,
                            duration: 'çº¦3å°æ—¶',
                            period: 'ä¸Šåˆ'
                        },
                        {
                            time: '14:00-17:00',
                            title: 'è‹å·åšç‰©é¦†',
                            description: 'è´è¿é“­è®¾è®¡çš„ç°ä»£å»ºç­‘ä¸è‹å·ä¼ ç»Ÿæ–‡åŒ–çš„å®Œç¾ç»“åˆã€‚é¦†è—ä¸°å¯Œï¼Œå±•ç¤ºè‹å·åœ°åŒºçš„å†å²æ–‡åŒ–å’Œè‰ºæœ¯çå“ã€‚',
                            icon: 'ğŸ›ï¸',
                            cost: 0,
                            duration: 'çº¦3å°æ—¶',
                            period: 'ä¸‹åˆ'
                        },
                        {
                            time: '18:00-20:30',
                            title: 'å¹³æ±Ÿè·¯å¤è¡—',
                            description: 'è‹å·ä¿å­˜æœ€å®Œæ•´çš„å¤è¡—åŒºï¼Œå°æ¡¥æµæ°´äººå®¶çš„å…¸å‹æ±Ÿå—æ°´ä¹¡é£è²Œã€‚å“å°è‹å¼å°åƒï¼Œè´­ä¹°ç‰¹è‰²æ‰‹å·¥è‰ºå“ã€‚',
                            icon: 'ğŸ®',
                            cost: 150,
                            duration: 'çº¦2.5å°æ—¶',
                            period: 'æ™šä¸Š'
                        }
                    ]
                },
                {
                    day: 2,
                    date: '9æœˆ2æ—¥ å‘¨ä¸€',
                    location: 'è‹å·å›­æ—åŒº',
                    weather: 'å¤šäº‘',
                    temperature: '24Â°C',
                    activities: [
                        {
                            time: '08:30-11:30',
                            title: 'ç•™å›­ç²¾å“æ¸¸',
                            description: 'ä¸­å›½å››å¤§åå›­ä¹‹ä¸€ï¼Œä»¥å»ºç­‘è‰ºæœ¯ç²¾æ¹›è‘—ç§°ã€‚å›­å†…å…å ‚ã€èµ°å»Šã€ç²‰å¢™ã€æ´é—¨ç­‰å»ºç­‘å°å“ï¼Œå¤„å¤„ä½“ç°æ±Ÿå—å›­æ—ç‰¹è‰²ã€‚',
                            icon: 'ğŸ‹',
                            cost: 55,
                            duration: 'çº¦3å°æ—¶',
                            period: 'ä¸Šåˆ'
                        },
                        {
                            time: '13:30-16:30',
                            title: 'ç½‘å¸ˆå›­å¤œæ¸¸',
                            description: 'ä¸–ç•Œæ–‡åŒ–é—äº§ï¼Œä»¥ç²¾è‡´å°å·§è‘—ç§°ã€‚å¤œæ¸¸ç½‘å¸ˆå›­æ˜¯è‹å·çš„ç‰¹è‰²é¡¹ç›®ï¼Œåœ¨ç¯å…‰æ˜ è¡¬ä¸‹åˆ«æœ‰ä¸€ç•ªéŸµå‘³ã€‚',
                            icon: 'ğŸŒ™',
                            cost: 100,
                            duration: 'çº¦3å°æ—¶',
                            period: 'ä¸‹åˆ'
                        }
                    ]
                },
                {
                    day: 3,
                    date: '9æœˆ3æ—¥ å‘¨äºŒ',
                    location: 'å‘¨åº„å¤é•‡',
                    weather: 'æ™´æœ—',
                    temperature: '28Â°C',
                    activities: [
                        {
                            time: '08:00-18:00',
                            title: 'å‘¨åº„æ°´ä¹¡ä¸€æ—¥æ¸¸',
                            description: 'ä¸­å›½ç¬¬ä¸€æ°´ä¹¡ï¼Œä¿å­˜å®Œå¥½çš„æ˜æ¸…å»ºç­‘ç¾¤ã€‚ä¹˜åæ‘‡æ©¹èˆ¹ç©¿è¡Œäºå¤é•‡æ°´å··ï¼Œæ„Ÿå—"å°æ¡¥æµæ°´äººå®¶"çš„è¯—æ„ç”Ÿæ´»ã€‚',
                            icon: 'ğŸš£',
                            cost: 280,
                            duration: 'å…¨å¤©',
                            period: 'å…¨å¤©'
                        }
                    ]
                },
                {
                    day: 4,
                    date: '9æœˆ4æ—¥ å‘¨ä¸‰',
                    location: 'è‹å·æ–°åŒº',
                    weather: 'æ™´æœ—',
                    temperature: '27Â°C',
                    activities: [
                        {
                            time: '09:00-12:00',
                            title: 'è™ä¸˜é£æ™¯åŒº',
                            description: 'è‹å·çš„è±¡å¾ï¼Œæœ‰"å´ä¸­ç¬¬ä¸€åèƒœ"ä¹‹ç§°ã€‚ç™»ä¸Šè™ä¸˜å¡”ï¼Œä¿¯ç°è‹å·åŸæ™¯ï¼Œäº†è§£æ˜¥ç§‹æ—¶æœŸçš„å†å²æ–‡åŒ–ã€‚',
                            icon: 'ğŸ—¼',
                            cost: 80,
                            duration: 'çº¦3å°æ—¶',
                            period: 'ä¸Šåˆ'
                        },
                        {
                            time: '14:30-17:30',
                            title: 'å¯’å±±å¯ºç¥ˆç¦',
                            description: 'å› å¼ ç»§çš„ã€Šæ«æ¡¥å¤œæ³Šã€‹è€Œé—»åå¤©ä¸‹ã€‚è†å¬å¯’å±±å¯ºé’Ÿå£°ï¼Œæ„Ÿå—"å§‘è‹åŸå¤–å¯’å±±å¯ºï¼Œå¤œåŠé’Ÿå£°åˆ°å®¢èˆ¹"çš„è¯—æ„ã€‚',
                            icon: 'ğŸ””',
                            cost: 20,
                            duration: 'çº¦3å°æ—¶',
                            period: 'ä¸‹åˆ'
                        }
                    ]
                },
                {
                    day: 5,
                    date: '9æœˆ5æ—¥ å‘¨å››',
                    location: 'è‹å·å¸‚ä¸­å¿ƒ',
                    weather: 'æ™´æœ—',
                    temperature: '29Â°C',
                    activities: [
                        {
                            time: '09:30-12:00',
                            title: 'ä¸ç»¸å·¥è‰ºä½“éªŒ',
                            description: 'å‚è§‚è‹å·ä¸ç»¸å‚ï¼Œäº†è§£ä¸ç»¸åˆ¶ä½œå·¥è‰ºï¼Œäº²æ‰‹ä½“éªŒç¼«ä¸ã€ç»‡ç»¸è¿‡ç¨‹ã€‚è‹å·ä¸ç»¸ä»¥è´¨åœ°ä¼˜è‰¯ã€å·¥è‰ºç²¾æ¹›é—»åäºä¸–ã€‚',
                            icon: 'ğŸ§µ',
                            cost: 120,
                            duration: 'çº¦2.5å°æ—¶',
                            period: 'ä¸Šåˆ'
                        },
                        {
                            time: '14:00-17:00',
                            title: 'è§‚å‰è¡—è´­ç‰©',
                            description: 'è‹å·æœ€ç¹åçš„å•†ä¸šè¡—ï¼Œè´­ä¹°è‹å·ç‰¹äº§ï¼šè‹ç»£ã€ä¸ç»¸ã€ç¢§èºæ˜¥èŒ¶ã€è‹å¼ç³•ç‚¹ç­‰ã€‚æ„Ÿå—ç°ä»£è‹å·çš„å•†ä¸šæ´»åŠ›ã€‚',
                            icon: 'ğŸ›ï¸',
                            cost: 450,
                            duration: 'çº¦3å°æ—¶',
                            period: 'ä¸‹åˆ'
                        }
                    ]
                }
            ],
            createdAt: new Date().toISOString()
        };

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            sessionId = urlParams.get('sessionId');

            if (!sessionId) {
                console.log('ğŸ­ è¿›å…¥æ¼”ç¤ºæ¨¡å¼');
                demoMode = true;
                loadDemoData();
            } else {
                loadTravelPlan();
            }
        });

        // åŠ è½½æ¼”ç¤ºæ•°æ®
        function loadDemoData() {
            console.log('ğŸ­ åŠ è½½æ¼”ç¤ºæ•°æ®');
            planData = demoData;

            setTimeout(() => {
                renderTravelPlan();
            }, 2000);
        }

        // åŠ è½½æ—…è¡Œè®¡åˆ’æ•°æ®
        async function loadTravelPlan() {
            try {
                console.log('ğŸ“‹ è·å–æ—…è¡Œè®¡åˆ’ç»“æœ:', sessionId);

                const response = await fetch(`/api/v1/planning/sessions/${sessionId}`);
                const result = await response.json();

                if (!response.ok) {
                    throw new Error(result.error?.message || 'è·å–æ•°æ®å¤±è´¥');
                }

                if (result.success && result.data) {
                    planData = {
                        id: sessionId,
                        title: `${result.data.destination}æ·±åº¦æ¸¸`,
                        destination: result.data.destination,
                        totalDays: result.data.totalDays || 0,
                        startDate: result.data.startDate || '',
                        endDate: result.data.endDate || '',
                        totalCost: calculateTotalCost(result.data.result?.itinerary || []),
                        groupSize: result.data.userPreferences?.groupSize || 2,
                        itinerary: result.data.result?.itinerary || [],
                        createdAt: new Date().toISOString()
                    };

                    renderTravelPlan();
                } else {
                    throw new Error('æ— æ•ˆçš„å“åº”æ•°æ®');
                }
            } catch (error) {
                console.error('âŒ åŠ è½½æ—…è¡Œè®¡åˆ’å¤±è´¥:', error);
                console.log('ğŸ­ APIè°ƒç”¨å¤±è´¥ï¼Œåˆ‡æ¢åˆ°æ¼”ç¤ºæ¨¡å¼');
                demoMode = true;
                loadDemoData();
            }
        }

        // è®¡ç®—æ€»è´¹ç”¨
        function calculateTotalCost(itinerary) {
            let total = 0;
            itinerary.forEach(day => {
                if (day.activities) {
                    day.activities.forEach(activity => {
                        total += activity.cost || 0;
                    });
                }
            });
            return total;
        }

        // è®¡ç®—æ´»åŠ¨æ€»æ•°
        function calculateActivitiesCount(itinerary) {
            let count = 0;
            itinerary.forEach(day => {
                if (day.activities) {
                    count += day.activities.length;
                }
            });
            return count;
        }

        // æ¸²æŸ“æ—…è¡Œè®¡åˆ’
        function renderTravelPlan() {
            // æ›´æ–°æ ‡é¢˜
            document.getElementById('planTitle').textContent = planData.title;
            document.getElementById('planSubtitle').textContent =
                `${planData.destination} Â· ${formatDateRange(planData.startDate, planData.endDate)}${demoMode ? ' (æ¼”ç¤ºæ¨¡å¼)' : ''}`;

            // æ›´æ–°æ¦‚è§ˆæ•°æ®
            document.getElementById('totalDays').textContent = planData.totalDays;
            document.getElementById('totalCost').textContent = `Â¥${planData.totalCost}`;
            document.getElementById('groupSize').textContent = `${planData.groupSize}äºº`;
            document.getElementById('activitiesCount').textContent = calculateActivitiesCount(planData.itinerary);

            // æ¸²æŸ“ç½‘æ ¼å¸ƒå±€
            const gridLayout = document.getElementById('gridLayout');
            gridLayout.innerHTML = '';

            if (planData.itinerary && planData.itinerary.length > 0) {
                planData.itinerary.forEach((day, index) => {
                    const daySection = createDaySection(day, index + 1);
                    gridLayout.appendChild(daySection);
                });
            } else {
                gridLayout.innerHTML = `
                    <div class="glass-effect rounded-3xl p-8 shadow-lg text-center animate-scale-in">
                        <div class="text-on-surface-variant mb-4">
                            <i class="fas fa-calendar-day text-5xl"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-on-surface mb-2">è¡Œç¨‹è¯¦æƒ…ç”Ÿæˆä¸­</h3>
                        <p class="text-on-surface-variant">æ­£åœ¨ä¸ºæ‚¨ç”Ÿæˆè¯¦ç»†çš„æ¯æ—¥è¡Œç¨‹å®‰æ’...</p>
                    </div>
                `;
            }

            // æ˜¾ç¤ºä¸»è¦å†…å®¹
            document.getElementById('loadingState').classList.add('hidden');
            document.getElementById('mainContent').classList.remove('hidden');
        }

        // åˆ›å»ºæ—¥ç¨‹éƒ¨åˆ†
        function createDaySection(dayData, dayNumber) {
            const section = document.createElement('div');
            section.className = 'animate-slide-up';
            section.style.animationDelay = `${dayNumber * 0.1}s`;
            
            section.innerHTML = `
                <!-- æ—¥ç¨‹æ ‡é¢˜ -->
                <div class="glass-effect rounded-3xl p-6 mb-6 shadow-lg">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 bg-gradient-to-r from-brand-primary to-brand-secondary text-white rounded-2xl flex items-center justify-center text-xl font-bold">
                                ${dayNumber}
                            </div>
                            <div>
                                <h3 class="text-2xl font-bold text-on-surface">ç¬¬ ${dayNumber} å¤©</h3>
                                <p class="text-on-surface-variant">${dayData.date || formatDate(dayNumber)}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-on-surface-variant flex items-center gap-2 justify-end">
                                <i class="fas fa-map-marker-alt text-brand-primary"></i>
                                ${dayData.location || planData.destination}
                            </p>
                            <p class="text-on-surface-variant flex items-center gap-2 justify-end mt-1">
                                <i class="fas fa-thermometer-half text-brand-secondary"></i>
                                ${dayData.weather || 'æ™´æœ—'} ${dayData.temperature || '25Â°C'}
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- æ´»åŠ¨ç½‘æ ¼ -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    ${(dayData.activities || []).map((activity, actIndex) => `
                        <div class="activity-card glass-effect rounded-3xl p-6 shadow-lg">
                            <div class="text-center mb-4">
                                <div class="text-4xl mb-3">${activity.icon || 'ğŸ“'}</div>
                                <div class="inline-block px-3 py-1 bg-gradient-to-r from-brand-primary/10 to-brand-secondary/10 text-brand-primary rounded-full text-sm font-medium mb-2">
                                    ${activity.time || 'å…¨å¤©'}
                                </div>
                            </div>
                            
                            <h4 class="text-lg font-semibold text-on-surface mb-3 text-center">${activity.title}</h4>
                            <p class="text-on-surface-variant text-sm mb-4 leading-relaxed">${activity.description}</p>
                            
                            <div class="flex items-center justify-between text-sm text-on-surface-variant pt-4 border-t border-outline/20">
                                <span class="flex items-center gap-1">
                                    <i class="fas fa-clock text-brand-primary"></i>
                                    ${activity.duration || 'çº¦2å°æ—¶'}
                                </span>
                                ${activity.cost ? `
                                    <span class="flex items-center gap-1 font-medium">
                                        <i class="fas fa-yen-sign text-success"></i>
                                        Â¥${activity.cost}
                                    </span>
                                ` : ''}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            return section;
        }

        // æ ¼å¼åŒ–æ—¥æœŸ
        function formatDate(dayNumber) {
            if (!planData.startDate) return `ç¬¬${dayNumber}å¤©`;
            
            const startDate = new Date(planData.startDate);
            const currentDate = new Date(startDate);
            currentDate.setDate(startDate.getDate() + dayNumber - 1);
            
            return currentDate.toLocaleDateString('zh-CN', { 
                month: 'long', 
                day: 'numeric',
                weekday: 'long'
            });
        }

        // æ ¼å¼åŒ–æ—¥æœŸèŒƒå›´
        function formatDateRange(startDate, endDate) {
            if (!startDate || !endDate) return '';
            
            const start = new Date(startDate);
            const end = new Date(endDate);
            
            return `${start.toLocaleDateString('zh-CN', { month: 'short', day: 'numeric' })} - ${end.toLocaleDateString('zh-CN', { month: 'short', day: 'numeric' })}`;
        }

        // æ˜¾ç¤ºé”™è¯¯
        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('loadingState').classList.add('hidden');
            document.getElementById('errorState').classList.remove('hidden');
        }

        // é‡è¯•åŠ è½½
        function retryLoad() {
            document.getElementById('errorState').classList.add('hidden');
            document.getElementById('loadingState').classList.remove('hidden');
            loadTravelPlan();
        }

        // è¿”å›ä¸Šä¸€é¡µ
        function goBack() {
            if (window.history.length > 1) {
                window.history.back();
            } else {
                window.location.href = '/planning';
            }
        }
    </script>
</body>
</html>
